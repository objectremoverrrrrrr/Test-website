<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://accounts.google.com; style-src-elem 'self' 'unsafe-inline' https://fonts.googleapis.com https://accounts.google.com; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://accounts.google.com https://plausible.io; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.ipify.org https://api.emailjs.com https://accounts.google.com https://plausible.io https://qualitics-production-1.onrender.com https://ipapi.co https://api.my-ip.io https://httpbin.org; img-src 'self' data: https:; frame-src 'self' https://accounts.google.com; object-src 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests; block-all-mixed-content">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <title>Qualitics Production - Admin Dashboard</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        /* Modern Dashboard Styles */
        .modern-dashboard {
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            font-family: 'Inter', sans-serif;
            color: #ffffff;
        }

        /* Header Bar */
        .dashboard-header-bar {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .back-home-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            color: #ffd700;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
        }

        .back-home-btn:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .dashboard-logo {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .logo-main-text {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-sub-text {
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            color: #666;
            letter-spacing: 2px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .user-profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
        }

        .user-avatar-header {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .user-info-header {
            display: flex;
            flex-direction: column;
        }

        .user-name-header {
            font-weight: 600;
            color: #ffd700;
        }

        .user-role-header {
            font-size: 0.8rem;
            color: #666;
        }

        .logout-btn-header {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            color: #ff6b6b;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .logout-btn-header:hover {
            background: rgba(255, 68, 68, 0.2);
            transform: translateY(-1px);
        }

        /* Main Dashboard Container */
        .dashboard-main-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Modern Sidebar */
        .modern-sidebar {
            width: 280px;
            background: linear-gradient(180deg, rgba(26, 26, 26, 0.9) 0%, rgba(15, 15, 15, 0.9) 100%);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 215, 0, 0.1);
            padding: 2rem 0;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-section-title {
            padding: 0 2rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .sidebar-nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav-item {
            margin: 0.25rem 1rem;
        }

        .sidebar-nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: #ccc;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .sidebar-nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .sidebar-nav-link:hover::before {
            left: 100%;
        }

        .sidebar-nav-link:hover {
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.1);
        }

        .sidebar-nav-link.active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.2);
        }

        .nav-icon {
            font-size: 1.25rem;
            min-width: 24px;
            text-align: center;
        }

        .nav-text {
            flex: 1;
            font-size: 0.9rem;
        }

        .nav-badge {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .nav-count {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        /* Main Content Area */
        .dashboard-content {
            flex: 1;
            background: rgba(10, 10, 10, 0.5);
            overflow-y: auto;
            padding: 2rem;
        }

        /* Modern Tab Content */
        .tab-content-modern {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab-content-modern.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Content Header */
        .content-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .content-title {
            display: flex;
            flex-direction: column;
        }

        .content-title h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #ffd700;
            margin: 0;
            font-family: 'Orbitron', monospace;
        }

        .content-title p {
            color: #666;
            margin: 0.5rem 0 0 0;
            font-size: 1rem;
        }

        .content-actions {
            display: flex;
            gap: 1rem;
        }

        .action-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .action-button.secondary {
            background: transparent;
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #ffd700;
        }

        .action-button.secondary:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        /* Modern Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(15, 15, 15, 0.8));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 16px;
            padding: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ffd700, transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            font-size: 2.5rem;
            min-width: 60px;
            text-align: center;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #ffd700;
            margin: 0;
            font-family: 'Orbitron', monospace;
        }

        .stat-label {
            color: #999;
            margin: 0.5rem 0 0 0;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-change {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }

        .stat-change.negative {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        /* Data Table Styles */
        .data-table-container {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(15, 15, 15, 0.8));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .table-header {
            background: rgba(255, 215, 0, 0.05);
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .table-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffd700;
            margin: 0;
            font-family: 'Orbitron', monospace;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
            padding: 1.5rem;
            text-align: left;
            font-weight: 600;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
        }

        .data-table td {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.05);
            color: #ccc;
            font-size: 0.9rem;
        }

        .data-table tr:hover {
            background: rgba(255, 215, 0, 0.03);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .modern-sidebar {
                width: 240px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .dashboard-main-container {
                flex-direction: column;
            }

            .modern-sidebar {
                width: 100%;
                height: auto;
                padding: 1rem 0;
            }

            .sidebar-nav-link {
                padding: 0.75rem 1rem;
            }

            .dashboard-content {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .content-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: #ffd700;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Chart Container */
        .chart-container {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(15, 15, 15, 0.8));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 1.5rem;
            font-family: 'Orbitron', monospace;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            color: #ffd700;
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 10001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .modal.show {
            display: flex;
            opacity: 1;
        }

        .modal-content.modern {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.95), rgba(15, 15, 15, 0.95));
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 16px;
            padding: 2rem;
            width: 80%;
            max-width: 700px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            animation: fadeInScale 0.3s ease-in-out forwards;
            position: relative;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: #ffd700;
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 2.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: #ff6b6b;
        }

        .modal-body {
            color: #ccc;
            font-size: 0.95rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .modal-content .form-actions {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 215, 0, 0.1);
        }

        /* Specific styles for new product form fields */
        .image-upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .image-upload-section:hover {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.05);
        }

        .image-upload-section .upload-icon {
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 0.5rem;
        }

        .image-upload-section .upload-text {
            font-size: 1rem;
            color: #ccc;
            font-weight: 500;
        }

        #productImagePreview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 1rem;
            display: none; /* Hidden by default */
        }

        .description-section {
            display: grid;
            grid-template-columns: 1fr; /* Default to single column */
            gap: 1.5rem;
        }

        .description-section .form-group {
            margin-bottom: 0; /* Reset margin for groups within this section */
        }

        .description-section .form-input {
            min-height: 120px; /* Taller textarea for description */
        }

        .link-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Two columns for links */
            gap: 1.5rem;
        }

        .link-section .form-group {
            margin-bottom: 0; /* Reset margin */
        }

        .link-section .form-label {
            font-size: 0.85rem; /* Slightly smaller labels for links */
        }

        .link-section .form-input {
            padding: 0.6rem 0.8rem; /* Slightly smaller input for links */
            font-size: 0.85rem;
        }

        /* File Attachment Styles */
        .file-attachment-section {
            margin-top: 1.5rem;
        }

        .file-upload-container {
            border: 2px dashed rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .file-drop-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
        }

        .file-drop-zone:hover {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.05);
        }

        .file-drop-zone .upload-icon {
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 0.5rem;
        }

        .file-drop-zone .upload-text {
            font-size: 1rem;
            color: #ffd700;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .file-drop-zone .upload-subtitle {
            font-size: 0.8rem;
            color: #999;
            text-align: center;
        }

        .attached-files-list {
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .attached-file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .file-icon {
            font-size: 1.5rem;
        }

        .file-details {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            color: #ffd700;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .file-size {
            color: #999;
            font-size: 0.75rem;
        }

        .file-remove-btn {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .file-remove-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }

    </style>
</head>
<body class="modern-dashboard">
    <!-- Header Bar -->
    <header class="dashboard-header-bar">
        <div class="header-left">
            <a href="index.html" class="back-home-btn">
                <span>üè†</span>
                <span>Back to Home</span>
            </a>
            <div class="dashboard-logo">
                <span class="logo-main-text">QUALITICS</span>
                <span class="logo-sub-text">ADMIN DASHBOARD</span>
            </div>
        </div>
        <div class="header-right">
            <div class="user-profile-header">
                <div class="user-avatar-header">üë®‚Äçüíº</div>
                <div class="user-info-header">
                    <span class="user-name-header" id="adminNameHeader">Administrator</span>
                    <span class="user-role-header">Super Admin</span>
                </div>
            </div>
            <button class="logout-btn-header" onclick="signOut()">
                <span>üö™</span>
                <span>Logout</span>
            </button>
        </div>
    </header>

    <!-- Main Dashboard Container -->
    <div class="dashboard-main-container">
        <!-- Modern Sidebar -->
        <nav class="modern-sidebar">
            <div class="sidebar-section">
                <div class="sidebar-section-title">Overview</div>
                <ul class="sidebar-nav-list">
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link active" data-tab="analytics">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">Analytics</span>
                            <span class="nav-badge">Live</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Management</div>
                <ul class="sidebar-nav-list">
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link" data-tab="products">
                            <span class="nav-icon">üì¶</span>
                            <span class="nav-text">Products</span>
                            <span class="nav-count" id="productsCount">0</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Security</div>
                <ul class="sidebar-nav-list">
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link" data-tab="security">
                            <span class="nav-icon">üîí</span>
                            <span class="nav-text">Security</span>
                            <span class="nav-badge">üü¢</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link" data-tab="bans">
                            <span class="nav-icon">üö´</span>
                            <span class="nav-text">Ban Management</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link" data-tab="system-check">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span class="nav-text">System Check</span>
                            <span class="nav-badge" id="system-status">üü°</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="dashboard-content">
            <!-- Analytics Tab -->
            <div class="tab-content-modern active" id="analytics-tab">
                <div class="content-header">
                    <div class="content-title">
                        <h1>Analytics Dashboard</h1>
                        <p>Real-time insights and performance metrics</p>
                    </div>
                    <div class="content-actions">
                        <button class="action-button secondary" onclick="window.viewReports()">
                            <span>üì§</span>
                            <span>View Reports</span>
                        </button>
                        <button class="action-button" onclick="location.reload()">
                            <span>üîÑ</span>
                            <span>Refresh Data</span>
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalRevenue">$0.00</div>
                            <div class="stat-label">Total Revenue</div>
                            <div class="stat-change positive" id="revenueChange">+0%</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üëÅÔ∏è</div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalViews">0</div>
                            <div class="stat-label">Total Views</div>
                            <div class="stat-change positive" id="viewsChange">+0%</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üõí</div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalOrders">0</div>
                            <div class="stat-label">Orders</div>
                            <div class="stat-change positive" id="ordersChange">+0%</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-info">
                            <div class="stat-value" id="conversionRate">0.00%</div>
                            <div class="stat-label">Conversion Rate</div>
                            <div class="stat-change negative" id="conversionChange">-0%</div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">Sales Overview</h3>
                    <canvas id="salesChart" style="max-height: 400px;"></canvas>
                </div>
            </div>

            <!-- Products Tab -->
            <div class="tab-content-modern" id="products-tab">
                <div class="content-header">
                    <div class="content-title">
                        <h1>Product Management</h1>
                        <p>Manage your product catalog and inventory</p>
                    </div>
                    <div class="content-actions">
                        <button class="action-button" id="addProductBtn" onclick="window.addNewProduct()">
                            <span>‚ûï</span>
                            <span>Add Product</span>
                        </button>
                    </div>
                </div>

                <div class="data-table-container">
                    <div class="table-header">
                        <h3 class="table-title">Product List</h3>
                    </div>
                    <table class="data-table" id="productsTable">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Views</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>







            <!-- Security Tab -->
            <div class="tab-content-modern" id="security-tab">
                <div class="content-header">
                    <div class="content-title">
                        <h1>Security Center</h1>
                        <p>Monitor and manage system security</p>
                    </div>
                    <div class="content-actions">
                        <button class="action-button secondary" onclick="window.generateSecurityReport()">
                            <span>üìã</span>
                            <span>Security Report</span>
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üö´</div>
                        <div class="stat-info">
                            <div class="stat-value" id="bannedUsersCount">0</div>
                            <div class="stat-label">Banned Users</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üåê</div>
                        <div class="stat-info">
                            <div class="stat-value" id="bannedIPsCount">0</div>
                            <div class="stat-label">Banned IPs</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîê</div>
                        <div class="stat-info">
                            <div class="stat-value" id="activeSessionsCount">1</div>
                            <div class="stat-label">Active Sessions</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-info">
                            <div class="stat-value" id="securityAlerts">0</div>
                            <div class="stat-label">Security Alerts</div>
                        </div>
                    </div>
                </div>

                <div class="data-table-container">
                    <div class="table-header">
                        <h3 class="table-title">Security Log</h3>
                    </div>
                    <div class="security-log" id="securityLog" style="max-height: 400px; overflow-y: auto; padding: 1rem;">
                        <!-- Security events will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Ban Management Tab -->
            <div class="tab-content-modern" id="bans-tab">
                <div class="content-header">
                    <div class="content-title">
                        <h1>üõ°Ô∏è Secure Ban Management</h1>
                        <p>Advanced security control center with 99% bypass protection</p>
                    </div>
                    <div class="content-actions">
                        <button class="action-button secondary" onclick="exportSecureBanList()">
                            <span>üì§</span>
                            <span>Export Bans</span>
                        </button>
                        <button class="action-button secondary" onclick="performAdvancedCleanup()">
                            <span>üßπ</span>
                            <span>Advanced Cleanup</span>
                        </button>
                        <button class="action-button secondary" onclick="generateSecurityInsights()">
                            <span>üîç</span>
                            <span>Security Insights</span>
                        </button>
                        <button class="action-button" onclick="openSecureLogViewer()">
                            <span>üìä</span>
                            <span>Security Logs</span>
                        </button>
                    </div>
                </div>

                <!-- Advanced Security Statistics -->
                <div class="stats-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 51, 51, 0.1), rgba(255, 51, 51, 0.05)); border-color: rgba(255, 51, 51, 0.3);">
                        <div class="stat-icon" style="color: #ff3333;">üö´</div>
                        <div class="stat-info">
                            <div class="stat-value" id="secureBannedEmails">0</div>
                            <div class="stat-label">Banned Emails</div>
                            <div class="stat-change positive" id="emailBanTrend">+0 this week</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(255, 107, 107, 0.05)); border-color: rgba(255, 107, 107, 0.3);">
                        <div class="stat-icon" style="color: #ff6b6b;">üåê</div>
                        <div class="stat-info">
                            <div class="stat-value" id="secureBannedIPs">0</div>
                            <div class="stat-label">Banned IPs</div>
                            <div class="stat-change positive" id="ipBanTrend">+0 this week</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 152, 0, 0.05)); border-color: rgba(255, 152, 0, 0.3);">
                        <div class="stat-icon" style="color: #ff9800;">ü§ñ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="securityBlocks">0</div>
                            <div class="stat-label">Auto Blocks (24h)</div>
                            <div class="stat-change" id="autoBlockTrend">Real-time protection</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05)); border-color: rgba(76, 175, 80, 0.3);">
                        <div class="stat-icon" style="color: #4CAF50;">‚úÖ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="securityScore">99%</div>
                            <div class="stat-label">Protection Level</div>
                            <div class="stat-change positive">Ultra Secure</div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Ban Controls -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin-bottom: 2rem;">
                    <div class="data-table-container" style="background: linear-gradient(135deg, rgba(255, 51, 51, 0.05), rgba(26, 26, 26, 0.8)); border-color: rgba(255, 51, 51, 0.2);">
                        <div class="table-header" style="background: rgba(255, 51, 51, 0.1); border-color: rgba(255, 51, 51, 0.2);">
                            <h3 class="table-title" style="color: #ff3333;">üö´ Ban Email Address</h3>
                        </div>
                        <div style="padding: 1.5rem;">
                            <label class="form-label" style="color: #ff3333;">Target Email:</label>
                            <input type="email" placeholder="user@example.com" class="form-input" id="secureEmailBanInput" style="border-color: rgba(255, 51, 51, 0.3); margin-bottom: 1rem;">
                            <label class="form-label" style="color: #ff3333;">Ban Reason:</label>
                            <select class="form-input" id="secureEmailBanReason" style="border-color: rgba(255, 51, 51, 0.3); margin-bottom: 1rem;">
                                <option value="Security violation - Automated system">Security violation - Automated system</option>
                                <option value="Suspicious behavior patterns">Suspicious behavior patterns</option>
                                <option value="Bot/automation detected">Bot/automation detected</option>
                                <option value="Multiple failed attempts">Multiple failed attempts</option>
                                <option value="Fraudulent activity">Fraudulent activity</option>
                                <option value="Terms of service violation">Terms of service violation</option>
                                <option value="Manual administrative ban">Manual administrative ban</option>
                                <option value="Spam/abuse reports">Spam/abuse reports</option>
                            </select>
                            <button class="action-button" style="background: linear-gradient(135deg, #ff3333, #cc0000); width: 100%;" onclick="addSecureEmailBan()">
                                <span>üîí</span>
                                <span>Execute Secure Ban</span>
                            </button>
                        </div>
                    </div>

                    <div class="data-table-container" style="background: linear-gradient(135deg, rgba(255, 107, 107, 0.05), rgba(26, 26, 26, 0.8)); border-color: rgba(255, 107, 107, 0.2);">
                        <div class="table-header" style="background: rgba(255, 107, 107, 0.1); border-color: rgba(255, 107, 107, 0.2);">
                            <h3 class="table-title" style="color: #ff6b6b;">üåê Ban IP Address</h3>
                        </div>
                        <div style="padding: 1.5rem;">
                            <label class="form-label" style="color: #ff6b6b;">Target IP Address:</label>
                            <input type="text" placeholder="192.168.1.1 or 192.168.1.0/24" class="form-input" id="secureIPBanInput" style="border-color: rgba(255, 107, 107, 0.3); margin-bottom: 1rem;">
                            <label class="form-label" style="color: #ff6b6b;">Ban Type:</label>
                            <select class="form-input" id="secureIPBanType" style="border-color: rgba(255, 107, 107, 0.3); margin-bottom: 0.5rem;">
                                <option value="single">Single IP Address</option>
                                <option value="range">IP Range (CIDR)</option>
                                <option value="wildcard">Wildcard Pattern</option>
                            </select>
                            <label class="form-label" style="color: #ff6b6b;">Ban Reason:</label>
                            <select class="form-input" id="secureIPBanReason" style="border-color: rgba(255, 107, 107, 0.3); margin-bottom: 1rem;">
                                <option value="Malicious traffic detected">Malicious traffic detected</option>
                                <option value="Bot/scraper activity">Bot/scraper activity</option>
                                <option value="Proxy/VPN abuse">Proxy/VPN abuse</option>
                                <option value="Brute force attempts">Brute force attempts</option>
                                <option value="DDoS/flooding">DDoS/flooding</option>
                                <option value="Suspicious geographic location">Suspicious geographic location</option>
                                <option value="Manual security ban">Manual security ban</option>
                            </select>
                            <button class="action-button" style="background: linear-gradient(135deg, #ff6b6b, #cc0000); width: 100%;" onclick="addSecureIPBan()">
                                <span>üõ°Ô∏è</span>
                                <span>Execute IP Ban</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Real-time Security Monitoring -->
                <div class="data-table-container" style="margin-bottom: 2rem; background: linear-gradient(135deg, rgba(255, 152, 0, 0.05), rgba(26, 26, 26, 0.8)); border-color: rgba(255, 152, 0, 0.2);">
                    <div class="table-header" style="background: rgba(255, 152, 0, 0.1); border-color: rgba(255, 152, 0, 0.2);">
                        <h3 class="table-title" style="color: #ff9800;">‚ö° Real-time Security Monitor</h3>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                            <div style="background: rgba(0, 0, 0, 0.3); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="color: #4CAF50; font-size: 1.5rem; font-weight: bold;" id="activeConnections">0</div>
                                <div style="color: #999; font-size: 0.8rem;">Active Connections</div>
                            </div>
                            <div style="background: rgba(0, 0, 0, 0.3); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="color: #ff9800; font-size: 1.5rem; font-weight: bold;" id="behaviorScore">0</div>
                                <div style="color: #999; font-size: 0.8rem;">Current Behavior Score</div>
                            </div>
                            <div style="background: rgba(0, 0, 0, 0.3); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="color: #ff3333; font-size: 1.5rem; font-weight: bold;" id="threatLevel">LOW</div>
                                <div style="color: #999; font-size: 0.8rem;">Current Threat Level</div>
                            </div>
                        </div>
                        <div style="background: rgba(0, 0, 0, 0.5); border-radius: 8px; padding: 1rem; max-height: 200px; overflow-y: auto;" id="realtimeSecurityFeed">
                            <div style="color: #666; text-align: center; padding: 2rem;">üîí Security monitoring active - Waiting for events...</div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Ban Management Tables -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem;">
                    <div class="data-table-container" style="background: linear-gradient(135deg, rgba(255, 51, 51, 0.05), rgba(26, 26, 26, 0.8)); border-color: rgba(255, 51, 51, 0.2);">
                        <div class="table-header" style="background: rgba(255, 51, 51, 0.1); border-color: rgba(255, 51, 51, 0.2);">
                            <h3 class="table-title" style="color: #ff3333;">üö´ Banned Email Addresses</h3>
                            <button class="action-button secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="refreshSecureBanData()">
                                <span>üîÑ</span>
                                <span>Refresh</span>
                            </button>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="color: #ff3333;">Email Address</th>
                                        <th style="color: #ff3333;">Reason</th>
                                        <th style="color: #ff3333;">Date</th>
                                        <th style="color: #ff3333;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="secureBannedEmailsTable">
                                    <tr>
                                        <td colspan="4" style="text-align: center; color: #666; padding: 2rem;">No banned emails - System is secure</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="data-table-container" style="background: linear-gradient(135deg, rgba(255, 107, 107, 0.05), rgba(26, 26, 26, 0.8)); border-color: rgba(255, 107, 107, 0.2);">
                        <div class="table-header" style="background: rgba(255, 107, 107, 0.1); border-color: rgba(255, 107, 107, 0.2);">
                            <h3 class="table-title" style="color: #ff6b6b;">üåê Banned IP Addresses</h3>
                            <button class="action-button secondary" style="font-size: 0.8rem; padding: 0.5rem 1rem;" onclick="analyzeIPThreats()">
                                <span>üîç</span>
                                <span>Analyze</span>
                            </button>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="color: #ff6b6b;">IP Address</th>
                                        <th style="color: #ff6b6b;">Type</th>
                                        <th style="color: #ff6b6b;">Reason</th>
                                        <th style="color: #ff6b6b;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="secureBannedIPsTable">
                                    <tr>
                                        <td colspan="4" style="text-align: center; color: #666; padding: 2rem;">No banned IPs - System is protected</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Advanced Security Actions -->
                <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), rgba(26, 26, 26, 0.8)); border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 16px;">
                    <h3 style="color: #ffd700; margin-bottom: 1rem; font-family: 'Orbitron', monospace;">‚ö° Advanced Security Actions</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                        <button class="action-button secondary" onclick="clearAllSecureBans()" style="border-color: rgba(255, 107, 107, 0.3); color: #ff6b6b;">
                            <span>üßπ</span>
                            <span>Clear All Bans</span>
                        </button>
                        <button class="action-button secondary" onclick="exportSecurityLogs()">
                            <span>üìã</span>
                            <span>Export Logs</span>
                        </button>
                        <button class="action-button secondary" onclick="runSecurityScan()">
                            <span>üîç</span>
                            <span>Security Scan</span>
                        </button>
                        <button class="action-button secondary" onclick="optimizeSecuritySettings()">
                            <span>‚öôÔ∏è</span>
                            <span>Optimize Settings</span>
                        </button>
                    </div>
                </div>
            </div>


            <!-- System Check Tab -->
            <div class="tab-content-modern" id="system-check-tab">
                <div class="content-header">
                    <div class="content-title">
                        <h1>‚öôÔ∏è System Check</h1>
                        <p>Monitor and verify all system functions and services</p>
                    </div>
                    <div class="content-actions">
                        <button class="action-button secondary" onclick="runFullSystemCheck()">
                            <span>üîç</span>
                            <span>Run Full Check</span>
                        </button>
                        <button class="action-button secondary" onclick="exportSystemReport()">
                            <span>üìä</span>
                            <span>Export Report</span>
                        </button>
                        <button class="action-button" onclick="refreshSystemStatus()">
                            <span>üîÑ</span>
                            <span>Refresh Status</span>
                        </button>
                    </div>
                </div>

                <!-- System Status Overview -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); margin-bottom: 2rem;">
                    <div class="stat-card modern" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(26, 26, 26, 0.8)); border-color: rgba(76, 175, 80, 0.2);">
                        <div class="stat-header">
                            <h3>Overall Health</h3>
                            <span class="stat-icon" id="overall-health-icon">üü¢</span>
                        </div>
                        <div class="stat-value" id="overall-health-status">Checking...</div>
                        <div class="stat-description" id="overall-health-description">System initialization</div>
                    </div>
                    
                    <div class="stat-card modern" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(26, 26, 26, 0.8)); border-color: rgba(33, 150, 243, 0.2);">
                        <div class="stat-header">
                            <h3>Services Online</h3>
                            <span class="stat-icon">üîó</span>
                        </div>
                        <div class="stat-value" id="services-online-count">0/0</div>
                        <div class="stat-description">Active system services</div>
                    </div>
                    
                    <div class="stat-card modern" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(26, 26, 26, 0.8)); border-color: rgba(255, 193, 7, 0.2);">
                        <div class="stat-header">
                            <h3>Last Check</h3>
                            <span class="stat-icon">‚è∞</span>
                        </div>
                        <div class="stat-value" id="last-check-time">Never</div>
                        <div class="stat-description">System status update</div>
                    </div>
                    
                    <div class="stat-card modern" style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(26, 26, 26, 0.8)); border-color: rgba(156, 39, 176, 0.2);">
                        <div class="stat-header">
                            <h3>Issues Found</h3>
                            <span class="stat-icon">‚ö†Ô∏è</span>
                        </div>
                        <div class="stat-value" id="issues-count">0</div>
                        <div class="stat-description">Critical & warnings</div>
                    </div>
                </div>

                <!-- System Services Status -->
                <div class="data-table-container" style="margin-bottom: 2rem;">
                    <div class="table-header">
                        <h3 class="table-title">üîß System Services Status</h3>
                        <button class="action-button secondary" onclick="checkAllServices()" style="font-size: 0.8rem; padding: 0.5rem 1rem;">
                            <span>üîÑ</span>
                            <span>Check All</span>
                        </button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Status</th>
                                    <th>Response Time</th>
                                    <th>Last Check</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="systemServicesTable">
                                <!-- Services will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Function Tests -->
                <div class="data-table-container">
                    <div class="table-header">
                        <h3 class="table-title">‚ö° Function Tests</h3>
                        <button class="action-button secondary" onclick="runAllFunctionTests()" style="font-size: 0.8rem; padding: 0.5rem 1rem;">
                            <span>üß™</span>
                            <span>Test All</span>
                        </button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Function</th>
                                    <th>Status</th>
                                    <th>Result</th>
                                    <th>Execution Time</th>
                                    <th>Last Test</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="functionTestsTable">
                                <!-- Function tests will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modals -->
    <!-- Product Modal -->
    <div id="productFormModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
        <div class="modal-content modern" style="background: linear-gradient(135deg, #1a1a1a, #0f0f0f); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 16px; max-width: 700px; width: 90%; max-height: 90%; overflow-y: auto;">
            <div class="modal-header">
                <h2 id="productFormTitle">‚ú® Add New Product</h2>
                <button class="modal-close" onclick="closeProductModal()">&times;</button>
            </div>
            <form id="productForm" class="modern-form">
                <input type="hidden" id="productId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="productTitle" class="form-label">Product Title</label>
                        <input type="text" id="productTitle" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="productPrice" class="form-label">Price (USD)</label>
                        <input type="text" id="productPrice" class="form-input" required pattern="^\d+(\.\d{1,2})?$">
                    </div>
                    <div class="form-group">
                        <label for="productCategory" class="form-label">Category</label>
                        <select id="productCategory" class="form-input" required>
                            <option value="">Select Category</option>
                            <option value="music">üéµ Music Production</option>
                            <option value="fps">üéØ First Person Shooters</option>
                            <option value="design">üé® Design & Graphics</option>
                            <option value="development">üíª Development Tools</option>
                            <option value="productivity">‚ö° Productivity</option>
                            <option value="gaming">üéÆ Gaming Utilities</option>
                            <option value="security">üîí Security & Privacy</option>
                            <option value="other">üì¶ Other</option>
                        </select>
                    </div>

                    <!-- Image Upload Section -->
                    <div class="form-group full-width image-upload-section" id="imageUploadArea">
                        <input type="file" id="productImageInput" accept="image/*" style="display: none;">
                        <label for="productImageInput">
                            <span class="upload-icon">üñºÔ∏è</span>
                            <span class="upload-text">Drag & Drop or Click to Upload Product Image</span>
                        </label>
                        <img id="productImagePreview" src="#" alt="Product Image Preview">
                    </div>

                    <!-- File Attachment Section -->
                    <div class="form-group full-width file-attachment-section" id="fileAttachmentArea">
                        <label class="form-label">üìÅ Product Files (Auto-download after purchase)</label>
                        <div class="file-upload-container">
                            <input type="file" id="productFileInput" multiple style="display: none;">
                            <div class="file-drop-zone" onclick="document.getElementById('productFileInput').click()">
                                <span class="upload-icon">üìÅ</span>
                                <span class="upload-text">Click to attach files for this product</span>
                                <span class="upload-subtitle">Files will be automatically downloaded when users purchase this product</span>
                            </div>
                            <div id="attachedFilesList" class="attached-files-list"></div>
                        </div>
                    </div>

                    <!-- Description Section -->
                    <div class="form-group full-width description-section">
                        <label for="productDescription" class="form-label">Product Description</label>
                        <textarea id="productDescription" class="form-input" required></textarea>
                    </div>

                    <!-- Links Section -->
                    <div class="form-group full-width link-section">
                        <div class="form-group">
                            <label for="productYoutube" class="form-label">YouTube URL</label>
                            <input type="url" id="productYoutube" class="form-input" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                        <div class="form-group">
                            <label for="productExternal" class="form-label">External Link</label>
                            <input type="url" id="productExternal" class="form-input" placeholder="https://example.com/product">
                        </div>
                    </div>
                </div>
                <div class="form-actions" style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="action-button secondary" id="cancelBtn">Cancel</button>
                    <button type="submit" class="action-button">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Detail Modal -->
    <div id="userDetailModal" class="modal">
        <div class="modal-content modern">
            <div class="modal-header">
                <h2>User Details</h2>
                <button class="modal-close" onclick="closeUserDetailModal()">&times;</button>
            </div>
            <div id="userDetailContent" class="modal-body">
                <!-- User details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Google Sign-in -->
    <div id="g_id_onload"
         data-client_id="664588681727-tq89ueggq6bba6uqvkfkad3qtrfvvihf.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div id="google-signin-btn" style="display: none;"></div>

    <script>
        // Logging function for system events
        function logSystemEvent(message, severity = 'info', func = '', file = '') {
            const logEntry = {
                message: message,
                severity: severity,
                timestamp: new Date().toISOString(),
                function: func,
                file: file
            };
            const systemLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            systemLogs.unshift(logEntry); // Add to the beginning
            localStorage.setItem('systemLogs', JSON.stringify(systemLogs.slice(0, 100))); // Keep only last 100 logs
            console.log(`[${severity.toUpperCase()}] ${message}`); // Also log to console
        }

        // Function to clear outdated cache data
        function clearOutdatedData() {
            // Clean up old cached data that might interfere with current functionality
            const itemsToClean = ['tempData', 'demoContent', 'testItems'];
            itemsToClean.forEach(item => {
                if (localStorage.getItem(item)) {
                    localStorage.removeItem(item);
                }
            });
            
            // Clear old contact submissions older than 30 days
            try {
                const contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
                const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                const recentContacts = contacts.filter(contact => 
                    new Date(contact.timestamp).getTime() > thirtyDaysAgo
                );
                localStorage.setItem('contactSubmissions', JSON.stringify(recentContacts));
            } catch (error) {
                console.warn('Could not clean old contact data:', error);
            }
            
            console.log('Outdated data cleaned from localStorage.');
            logSystemEvent('Outdated data cleaned', 'info', 'clearOutdatedData', 'script.js');
        }

        // Modern Dashboard Tab System
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize navigation
            const navLinks = document.querySelectorAll('.sidebar-nav-link');
            const tabContents = document.querySelectorAll('.tab-content-modern');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    const targetTab = link.getAttribute('data-tab');

                    // Remove active class from all nav links
                    navLinks.forEach(nav => nav.classList.remove('active'));

                    // Add active class to clicked link
                    link.classList.add('active');

                    // Hide all tab contents
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });

                    // Show target tab content
                    const targetContent = document.getElementById(targetTab + '-tab');
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }

                    // Load content based on tab
                    loadTabContent(targetTab);
                });
            });

            // Initialize product modal functionality
            initProductModal();

            // Load initial content
            loadTabContent('analytics');

            // Clear any outdated cache data on dashboard load
            clearOutdatedData();
            logSystemEvent('Dashboard initialized', 'info', 'DOMContentLoaded', 'script.js');
        });

        function loadTabContent(tabName) {
            switch(tabName) {
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'products':
                    loadProductsTable();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'customers':
                    loadCustomersData();
                    break;
                case 'contacts':
                    loadContactSubmissions();
                    break;
                case 'security':
                    loadSecurityData();
                    break;
                case 'bans':
                    loadBannedUsers();
                    loadBannedIPs();
                    break;
                case 'console':
                    loadConsoleTab();
                    break;
                case 'system-check':
                    loadSystemCheckTab();
                    break;
                default:
                    logSystemEvent(`Unknown tab requested: ${tabName}`, 'warning', 'loadTabContent', 'script.js');
            }
        }

        // Product Modal Management
        function initProductModal() {
            const modal = document.getElementById('productFormModal');
            const closeBtn = modal?.querySelector('.modal-close');
            const cancelBtn = document.getElementById('cancelBtn');
            const productForm = document.getElementById('productForm');
            const productImageInput = document.getElementById('productImageInput');
            const imageUploadArea = document.getElementById('imageUploadArea');
            const productImagePreview = document.getElementById('productImagePreview');

            if (closeBtn) {
                closeBtn.addEventListener('click', closeProductModal);
            }

            if (cancelBtn) {
                cancelBtn.addEventListener('click', closeProductModal);
            }

            if (modal) {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeProductModal();
                    }
                });
            }

            if (productForm) {
                productForm.addEventListener('submit', handleProductSubmit);
            } else {
                console.error('Product form element not found!');
                logSystemEvent('Product form element not found during initProductModal', 'error', 'initProductModal', 'script.js');
            }

            // Image upload functionality
            if (productImageInput && imageUploadArea && productImagePreview) {
                imageUploadArea.addEventListener('click', () => productImageInput.click());

                productImageInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            productImagePreview.src = e.target.result;
                            productImagePreview.style.display = 'block';
                            imageUploadArea.querySelector('.upload-text').textContent = 'Image uploaded: ' + file.name;
                        }
                        reader.readAsDataURL(file);
                    }
                });
            } else {
                console.error('Image upload elements not found!');
                logSystemEvent('Image upload elements not found during initProductModal', 'error', 'initProductModal', 'script.js');
            }

            // File attachment functionality
            const productFileInput = document.getElementById('productFileInput');
            const fileDropZone = document.querySelector('.file-drop-zone');
            const attachedFilesList = document.getElementById('attachedFilesList');

            if (productFileInput && fileDropZone && attachedFilesList) {
                // Initialize IndexedDB for file storage
                initializeProductFileDB();

                // File selection handler
                productFileInput.addEventListener('change', function(event) {
                    handleFileSelection(event.target.files);
                });

                // Drag and drop handlers
                fileDropZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    fileDropZone.style.backgroundColor = 'rgba(255, 215, 0, 0.1)';
                });

                fileDropZone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    fileDropZone.style.backgroundColor = '';
                });

                fileDropZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    fileDropZone.style.backgroundColor = '';
                    handleFileSelection(e.dataTransfer.files);
                });
            } else {
                console.error('File attachment elements not found!');
                logSystemEvent('File attachment elements not found during initProductModal', 'error', 'initProductModal', 'script.js');
            }
        }

        async function openProductModal(product = null) {
            try {
                console.log('Opening product modal...');
                const modal = document.getElementById('productFormModal');
                const title = document.getElementById('productFormTitle');
                const form = document.getElementById('productForm');

                if (!modal) {
                    console.error('Product modal not found!');
                    showToast('Error: Product form not available', 'error');
                    logSystemEvent('Product modal element not found', 'error', 'openProductModal', 'script.js');
                    return;
                }

                console.log('Modal found, setting up...');

                if (product) {
                    title.textContent = '‚úèÔ∏è Edit Product';
                    await populateProductForm(product);
                } else {
                    title.textContent = '‚ú® Add New Product';
                    if (form) form.reset();
                    const productIdInput = document.getElementById('productId');
                    if (productIdInput) productIdInput.value = '';

                    // Clear image upload
                    const imagePreview = document.getElementById('productImagePreview');
                    const productImageInput = document.getElementById('productImageInput');
                    const imageUploadArea = document.getElementById('imageUploadArea');

                    if (imagePreview) imagePreview.style.display = 'none';
                    if (productImageInput) productImageInput.value = '';
                    if (imageUploadArea && imageUploadArea.querySelector('.upload-text')) {
                        imageUploadArea.querySelector('.upload-text').textContent = 'Drag & Drop or Click to Upload Product Image';
                    }

                    // Clear file attachments
                    currentlyAttachedFiles = [];
                    updateAttachedFilesList();
                }

                // Force display with important styles
                modal.style.display = 'flex !important';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.zIndex = '10000';
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';

                // Add a small delay to ensure styles are applied
                setTimeout(() => {
                    if (modal.style.display === 'none') {
                        modal.style.display = 'flex';
                    }
                }, 50);

                console.log('Modal opened successfully');
                showToast('Product form opened', 'success');
                logSystemEvent('Product modal opened', 'info', 'openProductModal', 'script.js');
            } catch (error) {
                console.error('Error opening product modal:', error);
                showToast('Error opening product form', 'error');
                logSystemEvent(`Error opening product modal: ${error.message}`, 'error', 'openProductModal', 'script.js');
            }
        }

        function closeProductModal() {
            const modal = document.getElementById('productFormModal');
            if (modal) {
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.classList.remove('show');
                document.body.style.overflow = '';
                logSystemEvent('Product modal closed', 'info', 'closeProductModal', 'script.js');
            } else {
                console.error('Product modal not found when trying to close!');
                logSystemEvent('Product modal not found when trying to close', 'error', 'closeProductModal', 'script.js');
            }
        }

        async function populateProductForm(product) {
            document.getElementById('productId').value = product.id;
            document.getElementById('productTitle').value = product.title;
            document.getElementById('productPrice').value = product.price.replace('$', '');
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productYoutube').value = product.youtube || '';
            document.getElementById('productExternal').value = product.external || '';

            // Set product image if available
            const productImagePreview = document.getElementById('productImagePreview');
            const imageUploadArea = document.getElementById('imageUploadArea');
            if (product.image) {
                if (productImagePreview) {
                    productImagePreview.src = product.image;
                    productImagePreview.style.display = 'block';
                }
                if (imageUploadArea && imageUploadArea.querySelector('.upload-text')) {
                    imageUploadArea.querySelector('.upload-text').textContent = 'Current Image';
                }
            } else {
                if (imageUploadArea && imageUploadArea.querySelector('.upload-text')) {
                    imageUploadArea.querySelector('.upload-text').textContent = 'Drag & Drop or Click to Upload Product Image';
                }
            }

            // Load existing attached files for editing
            try {
                currentlyAttachedFiles = [];
                const existingFiles = await loadProductFiles(product.id);
                if (existingFiles && existingFiles.length > 0) {
                    // Convert IndexedDB files back to the format expected by the UI
                    currentlyAttachedFiles = existingFiles.map(file => ({
                        name: file.fileName,
                        size: file.fileSize,
                        type: file.fileType,
                        lastModified: file.lastModified,
                        isExisting: true, // Mark as existing file
                        fileId: file.id
                    }));
                    updateAttachedFilesList();
                }
            } catch (error) {
                console.error('Error loading existing files:', error);
                logSystemEvent(`Error loading existing files for product ${product.id}: ${error.message}`, 'error', 'populateProductForm', 'script.js');
            }
        }

        function handleProductSubmit(e) {
            e.preventDefault();

            const productId = document.getElementById('productId').value;
            const productImageInput = document.getElementById('productImageInput');
            const productImagePreview = document.getElementById('productImagePreview');
            const imageFile = productImageInput.files[0];

            let productImageData = null;

            // Handle image upload
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    productImageData = event.target.result;
                    processProductData(productImageData);
                };
                reader.readAsDataURL(imageFile);
            } else if (productId && productImagePreview.src && productImagePreview.style.display === 'block') {
                // If editing and an image is already present, keep it
                productImageData = productImagePreview.src;
                processProductData(productImageData);
            } else {
                // No new image and no existing image to keep
                processProductData(null);
            }

            function processProductData(imageData) {
                // Get existing products from localStorage (not from global variable)
                let products = JSON.parse(localStorage.getItem('products') || '[]');

                // Check if we're at the 1000 product limit
                if (!productId && products.length >= 1000) {
                    showToast('Maximum product limit reached (1000). Tell Emris to update the goddam website!', 'error');
                    return;
                }

                const product = {
                    id: productId || Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9), // Ensure unique ID
                    title: document.getElementById('productTitle').value,
                    price: '$' + parseFloat(document.getElementById('productPrice').value || 0).toFixed(2),
                    originalPrice: '$' + parseFloat(document.getElementById('productPrice').value || 0).toFixed(2),
                    category: document.getElementById('productCategory').value,
                    description: document.getElementById('productDescription').value,
                    youtube: window.sanitizeInput ? window.sanitizeInput(document.getElementById('productYoutube').value) : document.getElementById('productYoutube').value,
                    external: window.sanitizeInput ? window.sanitizeInput(document.getElementById('productExternal').value) : document.getElementById('productExternal').value,
                    views: productId ? (products.find(p => p.id === productId)?.views || 0) : 0, // Preserve existing views on edit
                    dateCreated: productId ? (products.find(p => p.id === productId)?.dateCreated || new Date().toISOString()) : new Date().toISOString(),
                    image: imageData || '', // Store image data (base64)
                    attachedFiles: currentlyAttachedFiles || [] // Store file references
                };

                // Security: Validate product data
                if (window.securityManager) {
                    const validationErrors = window.securityManager.validateProductData(product);
                    if (validationErrors.length > 0) {
                        showToast(`Product validation failed: ${validationErrors.join(', ')}`, 'error');
                        return;
                    }
                }

                if (productId) {
                    // Update existing product
                    const index = products.findIndex(p => p.id === productId);
                    if (index !== -1) {
                        products[index] = { ...products[index], ...product };
                        logSystemEvent(`Product updated: ${product.title}`, 'info', 'handleProductSubmit', 'script.js');
                    }
                } else {
                    // Add new product to the beginning of the array
                    products.unshift(product);
                    logSystemEvent(`Product added: ${product.title} (Total products: ${products.length})`, 'info', 'handleProductSubmit', 'script.js');
                }

                // Save to localStorage
                localStorage.setItem('products', JSON.stringify(products));

                // Save attached files to IndexedDB if any
                if (currentlyAttachedFiles && currentlyAttachedFiles.length > 0) {
                    saveProductFilesToDB(product.id, currentlyAttachedFiles);
                }

                // Force refresh the product table
                loadProductsTable();
                closeProductModal();
                updateNavigationCounts();
                showToast(`Product ${productId ? 'updated' : 'added'} successfully! (${products.length} total products)`, 'success');
            }
        }

        // Products Management
        function loadProductsTable() {
            const tableBody = document.getElementById('productsTableBody');
            if (!tableBody) {
                console.error('Products table body not found!');
                logSystemEvent('Products table body not found', 'error', 'loadProductsTable', 'script.js');
                return;
            }

            // Always get fresh data from localStorage
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            tableBody.innerHTML = '';

            console.log(`Loading ${products.length} products to table`);

            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üì¶</div>
                            <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">No products found</div>
                            <div style="font-size: 0.9rem;">Click "Add Product" to create your first product</div>
                        </td>
                    </tr>
                `;
                return;
            }

            products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            ${product.image ? `<img src="${product.image}" alt="${product.title}" style="width: 50px; height: 50px; border-radius: 8px; object-fit: cover;">` : '<div style="width: 50px; height: 50px; background: #222; border-radius: 8px; display: flex; align-items: center; justify-content: center;"><span style="font-size: 1.5rem;">üñºÔ∏è</span></div>'}
                            <div>
                                <div style="font-weight: 600; color: #fff; margin-bottom: 0.25rem;">${product.title}</div>
                                <div style="font-size: 0.8rem; color: #666;">ID: ${product.id}</div>
                                <div style="font-size: 0.7rem; color: #444;">Position: ${index + 1}/${products.length}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span style="background: rgba(255, 215, 0, 0.2); color: #ffd700; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">
                            ${getCategoryName(product.category)}
                        </span>
                    </td>
                    <td style="font-weight: 600; color: #4CAF50; font-family: monospace;">
                        ${product.discount && product.discount > 0 ? 
                            `<div style="display: flex; flex-direction: column; align-items: flex-start;">
                                <span style="color: #4CAF50;">${product.price}</span>
                                <span style="color: #666; text-decoration: line-through; font-size: 0.8rem;">${product.originalPrice}</span>
                                <span style="background: #ff4444; color: white; padding: 0.1rem 0.3rem; border-radius: 8px; font-size: 0.7rem;">-${product.discount}%</span>
                            </div>` 
                            : (product.price || '$0.00')}
                    </td>
                    <td>
                        <span style="padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; background: rgba(76, 175, 80, 0.2); color: #4CAF50;">
                            Active
                        </span>
                    </td>
                    <td style="color: #666;">${product.views || 0}</td>
                    <td>
                        <button onclick="editProduct('${product.id}')" style="background: rgba(255, 215, 0, 0.2); border: 1px solid rgba(255, 215, 0, 0.3); color: #ffd700; padding: 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.5rem;">‚úèÔ∏è</button>
                        <button onclick="deleteProduct('${product.id}')" style="background: rgba(255, 107, 107, 0.2); border: 1px solid rgba(255, 107, 107, 0.3); color: #ff6b6b; padding: 0.5rem; border-radius: 4px; cursor: pointer;">üóëÔ∏è</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            updateNavigationCounts();
            logSystemEvent(`Products table loaded with ${products.length} products`, 'info', 'loadProductsTable', 'script.js');
        }

        // IndexedDB File Management System
        let productFileDB = null;
        let currentlyAttachedFiles = [];

        function initializeProductFileDB() {
            const request = indexedDB.open('ProductFilesDB', 1);

            request.onerror = function(event) {
                console.error('Database error:', event.target.error);
                logSystemEvent(`IndexedDB error: ${event.target.error}`, 'error', 'initializeProductFileDB', 'script.js');
            };

            request.onsuccess = function(event) {
                productFileDB = event.target.result;
                console.log('Product files database initialized successfully');
                logSystemEvent('Product files database initialized', 'info', 'initializeProductFileDB', 'script.js');
            };

            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                
                // Create object store for product files
                if (!db.objectStoreNames.contains('productFiles')) {
                    const objectStore = db.createObjectStore('productFiles', { keyPath: 'id', autoIncrement: true });
                    objectStore.createIndex('productId', 'productId', { unique: false });
                    objectStore.createIndex('fileName', 'fileName', { unique: false });
                }
                console.log('Database schema created/updated');
                logSystemEvent('Product files database schema created/updated', 'info', 'initializeProductFileDB', 'script.js');
            };
        }

        function handleFileSelection(files) {
            if (!files || files.length === 0) return;

            Array.from(files).forEach(file => {
                // Check file size (limit to 50MB per file)
                if (file.size > 50 * 1024 * 1024) {
                    showToast(`File "${file.name}" is too large. Maximum size is 50MB.`, 'error');
                    return;
                }

                // Check if file already attached
                if (currentlyAttachedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    showToast(`File "${file.name}" is already attached.`, 'warning');
                    return;
                }

                // Add to currently attached files
                const fileData = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified,
                    file: file // Store the actual file object temporarily
                };

                currentlyAttachedFiles.push(fileData);
                updateAttachedFilesList();
                showToast(`File "${file.name}" attached successfully!`, 'success');
            });
        }

        function updateAttachedFilesList() {
            const attachedFilesList = document.getElementById('attachedFilesList');
            if (!attachedFilesList) return;

            if (currentlyAttachedFiles.length === 0) {
                attachedFilesList.innerHTML = '';
                return;
            }

            attachedFilesList.innerHTML = currentlyAttachedFiles.map((file, index) => `
                <div class="attached-file-item">
                    <div class="file-info">
                        <div class="file-icon">${getFileIcon(file.type)}</div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <button class="file-remove-btn" onclick="removeAttachedFile(${index})">
                        üóëÔ∏è Remove
                    </button>
                </div>
            `).join('');
        }

        function removeAttachedFile(index) {
            if (index >= 0 && index < currentlyAttachedFiles.length) {
                const fileName = currentlyAttachedFiles[index].name;
                currentlyAttachedFiles.splice(index, 1);
                updateAttachedFilesList();
                showToast(`File "${fileName}" removed.`, 'info');
            }
        }

        function getFileIcon(mimeType) {
            if (mimeType.startsWith('image/')) return 'üñºÔ∏è';
            if (mimeType.startsWith('video/')) return 'üé•';
            if (mimeType.startsWith('audio/')) return 'üéµ';
            if (mimeType.includes('pdf')) return 'üìÑ';
            if (mimeType.includes('zip') || mimeType.includes('rar') || mimeType.includes('7z')) return 'üì¶';
            if (mimeType.includes('document') || mimeType.includes('word')) return 'üìù';
            if (mimeType.includes('spreadsheet') || mimeType.includes('excel')) return 'üìä';
            if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return 'üìã';
            return 'üìÅ';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function saveProductFilesToDB(productId, files) {
            if (!productFileDB || !files || files.length === 0) return;

            const transaction = productFileDB.transaction(['productFiles'], 'readwrite');
            const objectStore = transaction.objectStore('productFiles');

            files.forEach((fileData, index) => {
                // Security: Validate file before saving
                if (window.securityManager) {
                    const validationErrors = window.securityManager.validateFileUpload(fileData.file);
                    if (validationErrors.length > 0) {
                        showToast(`File validation failed: ${validationErrors.join(', ')}`, 'error');
                        return;
                    }
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileRecord = {
                        productId: window.sanitizeInput ? window.sanitizeInput(productId) : productId,
                        fileName: window.sanitizeInput ? window.sanitizeInput(fileData.name) : fileData.name,
                        fileSize: fileData.size,
                        fileType: window.sanitizeInput ? window.sanitizeInput(fileData.type) : fileData.type,
                        lastModified: fileData.lastModified,
                        fileData: e.target.result, // Base64 encoded file data
                        uploadDate: new Date().toISOString()
                    };

                    const request = objectStore.add(fileRecord);
                    request.onsuccess = function() {
                        console.log(`File "${fileData.name}" saved to IndexedDB for product ${productId}`);
                        logSystemEvent(`File "${fileData.name}" saved for product ${productId}`, 'info', 'saveProductFilesToDB', 'script.js');
                    };
                    request.onerror = function() {
                        console.error(`Failed to save file "${fileData.name}" to IndexedDB`);
                        logSystemEvent(`Failed to save file "${fileData.name}" for product ${productId}`, 'error', 'saveProductFilesToDB', 'script.js');
                    };
                };
                reader.readAsDataURL(fileData.file);
            });
        }

        function loadProductFiles(productId) {
            return new Promise((resolve, reject) => {
                if (!productFileDB) {
                    resolve([]);
                    return;
                }

                const transaction = productFileDB.transaction(['productFiles'], 'readonly');
                const objectStore = transaction.objectStore('productFiles');
                const index = objectStore.index('productId');
                const request = index.getAll(productId);

                request.onsuccess = function() {
                    resolve(request.result || []);
                };

                request.onerror = function() {
                    console.error('Failed to load product files');
                    logSystemEvent(`Failed to load files for product ${productId}`, 'error', 'loadProductFiles', 'script.js');
                    reject(request.error);
                };
            });
        }

        async function downloadProductFiles(productId) {
            try {
                const files = await loadProductFiles(productId);
                if (!files || files.length === 0) {
                    showToast('No files found for this product.', 'info');
                    return;
                }

                // Download each file
                files.forEach(file => {
                    const link = document.createElement('a');
                    link.href = file.fileData;
                    link.download = file.fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });

                showToast(`Downloaded ${files.length} file(s) successfully!`, 'success');
                logSystemEvent(`Downloaded ${files.length} files for product ${productId}`, 'info', 'downloadProductFiles', 'script.js');
            } catch (error) {
                console.error('Error downloading product files:', error);
                showToast('Failed to download product files.', 'error');
                logSystemEvent(`Error downloading files for product ${productId}: ${error.message}`, 'error', 'downloadProductFiles', 'script.js');
            }
        }

        // Global Add Product Function
        window.addNewProduct = function() {
            openProductModal();
        };

        // Global Export Users Function
        window.exportUsers = function() {
            try {
                const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');

                if (users.length === 0) {
                    showToast('No users to export', 'warning');
                    logSystemEvent('Attempted to export users but found none', 'warning', 'exportUsers', 'script.js');
                    return;
                }

                const exportData = {
                    exportedAt: new Date().toISOString(),
                    totalUsers: users.length,
                    users: users.map(user => ({
                        email: user.email,
                        name: user.name,
                        joinDate: user.joinDate,
                        totalPurchases: user.totalPurchases || 0,
                        totalSpent: user.totalSpent || 0,
                        qualityPoints: user.qualityPoints || 0,
                        isPremium: user.isPremium || false,
                        lastActive: user.lastActive
                    }))
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `users_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showToast(`Successfully exported ${users.length} users!`, 'success');
                logSystemEvent(`Exported ${users.length} users`, 'info', 'exportUsers', 'script.js');
            } catch (error) {
                console.error('Error exporting users:', error);
                showToast('Failed to export users', 'error');
                logSystemEvent(`Error exporting users: ${error.message}`, 'error', 'exportUsers', 'script.js');
            }
        };

        // Global View Reports Function
        window.viewReports = function() {
            try {
                const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
                const contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');

                const totalRevenue = purchases.reduce((sum, p) => sum + (p.finalTotal || 0), 0);
                const totalViews = products.reduce((sum, p) => sum + (p.views || 0), 0);

                const reportModal = document.createElement('div');
                reportModal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;

                reportModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #1a1a1a, #0f0f0f); border: 1px solid #ffd700; border-radius: 16px; padding: 2rem; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #ffd700; margin: 0; font-family: 'Orbitron', monospace;">üìä Business Reports</h2>
                            <button onclick="document.body.removeChild(this.closest('div').parentElement)" style="background: none; border: none; color: #ffd700; font-size: 1.5rem; cursor: pointer;">&times;</button>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ffd700; font-weight: bold;">$${totalRevenue.toFixed(2)}</div>
                                <div style="color: #999;">Total Revenue</div>
                            </div>
                            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ffd700; font-weight: bold;">${users.length}</div>
                                <div style="color: #999;">Total Users</div>
                            </div>
                            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ffd700; font-weight: bold;">${products.length}</div>
                                <div style="color: #999;">Total Products</div>
                            </div>
                            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ffd700; font-weight: bold;">${purchases.length}</div>
                                <div style="color: #999;">Total Orders</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <h3 style="color: #ffd700; margin-bottom: 1rem;">üìà Performance Metrics</h3>
                            <div style="background: rgba(0, 0, 0, 0.3); padding: 1rem; border-radius: 8px;">
                                <div style="color: #fff; margin-bottom: 0.5rem;">‚Ä¢ Total Page Views: ${totalViews.toLocaleString()}</div>
                                <div style="color: #fff; margin-bottom: 0.5rem;">‚Ä¢ Conversion Rate: ${totalViews > 0 ? ((purchases.length / totalViews) * 100).toFixed(2) : '0.00'}%</div>
                                <div style="color: #fff; margin-bottom: 0.5rem;">‚Ä¢ Average Order Value: $${purchases.length > 0 ? (totalRevenue / purchases.length).toFixed(2) : '0.00'}</div>
                                <div style="color: #fff;">‚Ä¢ Messages Received: ${contacts.length}</div>
                            </div>
                        </div>

                        <div style="text-align: center;">
                            <button onclick="window.exportFullReport()" style="background: linear-gradient(45deg, #ffd700, #ffed4e); color: #000; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-right: 1rem;">
                                üì§ Export Full Report
                            </button>
                            <button onclick="document.body.removeChild(this.closest('div').parentElement)" style="background: rgba(255, 107, 107, 0.2); border: 1px solid rgba(255, 107, 107, 0.3); color: #ff6b6b; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                Close
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(reportModal);
                // Force reflow to ensure CSS transition applies
                requestAnimationFrame(() => {
                    reportModal.style.opacity = '1';
                });
                showToast('Reports generated successfully!', 'success');
                logSystemEvent('Business reports viewed', 'info', 'viewReports', 'script.js');
            } catch (error) {
                console.error('Error generating reports:', error);
                showToast('Failed to generate reports', 'error');
                logSystemEvent(`Error generating reports: ${error.message}`, 'error', 'viewReports', 'script.js');
            }
        };

        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10001;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
                font-family: 'Inter', sans-serif;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;

            switch(type) {
                case 'success':
                    toast.style.background = 'linear-gradient(135deg, #4CAF50, #66BB6A)';
                    break;
                case 'error':
                    toast.style.background = 'linear-gradient(135deg, #f44336, #ff6b6b)';
                    break;
                case 'warning':
                    toast.style.background = 'linear-gradient(135deg, #ff9800, #ffb74d)';
                    break;
                default:
                    toast.style.background = 'linear-gradient(135deg, #2196F3, #42A5F5)';
            }

            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Global Export Full Report Function
        window.exportFullReport = function() {
            try {
                const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
                const contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
                const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');

                const fullReport = {
                    generatedAt: new Date().toISOString(),
                    summary: {
                        totalUsers: users.length,
                        totalProducts: products.length,
                        totalPurchases: purchases.length,
                        totalRevenue: purchases.reduce((sum, p) => sum + (p.finalTotal || 0), 0),
                        totalMessages: contacts.length,
                        totalSecurityEvents: securityLog.length
                    },
                    users: users,
                    products: products,
                    purchases: purchases,
                    contacts: contacts,
                    securityEvents: securityLog.slice(0, 100) // Last 100 events
                };

                const dataStr = JSON.stringify(fullReport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `full_business_report_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showToast('Full report exported successfully!', 'success');
                logSystemEvent('Full business report exported', 'info', 'exportFullReport', 'script.js');
            } catch (error) {
                console.error('Error exporting full report:', error);
                showToast('Failed to export full report', 'error');
                logSystemEvent(`Error exporting full report: ${error.message}`, 'error', 'exportFullReport', 'script.js');
            }
        };

        // Global Security Report Function
        window.generateSecurityReport = function() {
            try {
                const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');
                const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
                const bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');

                const last24Hours = Date.now() - (24 * 60 * 60 * 1000);
                const recentEvents = securityLog.filter(event => 
                    new Date(event.timestamp).getTime() > last24Hours
                );

                const criticalEvents = recentEvents.filter(e => e.severity === 'critical').length;
                const warningEvents = recentEvents.filter(e => e.severity === 'warning').length;
                const infoEvents = recentEvents.filter(e => e.severity === 'info').length;

                const reportModal = document.createElement('div');
                reportModal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;

                reportModal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #1a1a1a, #0f0f0f); border: 1px solid #ffd700; border-radius: 16px; padding: 2rem; max-width: 700px; width: 90%; max-height: 80%; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="color: #ffd700; margin: 0; font-family: 'Orbitron', monospace;">üîí Security Report</h2>
                            <button onclick="document.body.removeChild(this.closest('div').parentElement)" style="background: none; border: none; color: #ffd700; font-size: 1.5rem; cursor: pointer;">&times;</button>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ff6b6b; font-weight: bold;">${criticalEvents}</div>
                                <div style="color: #999;">Critical Events (24h)</div>
                            </div>
                            <div style="background: rgba(255, 152, 0, 0.1); border: 1px solid rgba(255, 152, 0, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ff9800; font-weight: bold;">${warningEvents}</div>
                                <div style="color: #999;">Warning Events (24h)</div>
                            </div>
                            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ffd700; font-weight: bold;">${bannedUsers.length}</div>
                                <div style="color: #999;">Banned Users</div>
                            </div>
                            <div style="background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="font-size: 2rem; color: #ffd700; font-weight: bold;">${bannedIPs.length}</div>
                                <div style="color: #999;">Banned IPs</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 2rem;">
                            <h3 style="color: #ffd700; margin-bottom: 1rem;">üö® Recent Security Events</h3>
                            <div style="background: rgba(0, 0, 0, 0.5); padding: 1rem; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                                ${recentEvents.slice(0, 10).map(event => `
                                    <div style="margin-bottom: 0.5rem; padding: 0.5rem; border-left: 3px solid ${
                                        event.severity === 'critical' ? '#ff6b6b' : 
                                        event.severity === 'warning' ? '#ff9800' : '#4CAF50'
                                    }; background: rgba(255, 255, 255, 0.05);">
                                        <div style="font-size: 0.8rem; color: #666;">${new Date(event.timestamp).toLocaleString()}</div>
                                        <div style="color: #fff; font-size: 0.9rem;">${event.message}</div>
                                    </div>
                                `).join('') || '<div style="color: #999; text-align: center;">No recent security events</div>'}
                            </div>
                        </div>

                        <div style="text-align: center;">
                            <button onclick="window.exportSecurityReport()" style="background: linear-gradient(45deg, #ffd700, #ffed4e); color: #000; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; margin-right: 1rem;">
                                üì§ Export Security Report
                            </button>
                            <button onclick="document.body.removeChild(this.closest('div').parentElement)" style="background: rgba(255, 107, 107, 0.2); border: 1px solid rgba(255, 107, 107, 0.3); color: #ff6b6b; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                Close
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(reportModal);
                requestAnimationFrame(() => {
                    reportModal.style.opacity = '1';
                });
                showToast('Security report generated!', 'success');
                logSystemEvent('Security report generated', 'info', 'generateSecurityReport', 'script.js');
            } catch (error) {
                console.error('Error generating security report:', error);
                showToast('Failed to generate security report', 'error');
                logSystemEvent(`Error generating security report: ${error.message}`, 'error', 'generateSecurityReport', 'script.js');
            }
        };

        // Global Export Security Report Function
        window.exportSecurityReport = function() {
            try {
                const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');
                const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
                const bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');

                const securityReport = {
                    generatedAt: new Date().toISOString(),
                    summary: {
                        totalSecurityEvents: securityLog.length,
                        bannedUsers: bannedUsers.length,
                        bannedIPs: bannedIPs.length,
                        criticalEvents: securityLog.filter(e => e.severity === 'critical').length,
                        warningEvents: securityLog.filter(e => e.severity === 'warning').length,
                        infoEvents: securityLog.filter(e => e.severity === 'info').length
                    },
                    securityEvents: securityLog,
                    bannedUsers: bannedUsers,
                    bannedIPs: bannedIPs
                };

                const dataStr = JSON.stringify(securityReport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `security_report_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showToast('Security report exported successfully!', 'success');
                logSystemEvent('Security report exported', 'info', 'exportSecurityReport', 'script.js');
            } catch (error) {
                console.error('Error exporting security report:', error);
                showToast('Failed to export security report', 'error');
                logSystemEvent(`Error exporting security report: ${error.message}`, 'error', 'exportSecurityReport', 'script.js');
            }
        };

        function editProduct(productId) {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const product = products.find(p => p.id === productId);
            if (product) {
                openProductModal(product);
            } else {
                logSystemEvent(`Product not found for editing: ${productId}`, 'error', 'editProduct', 'script.js');
            }
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                let products = JSON.parse(localStorage.getItem('products') || '[]');
                products = products.filter(p => p.id !== productId);
                localStorage.setItem('products', JSON.stringify(products));
                loadProductsTable();
                updateNavigationCounts();
                showToast('Product deleted successfully!', 'success');
                logSystemEvent(`Product deleted: ${productId}`, 'info', 'deleteProduct', 'script.js');
            }
        }

        function getCategoryName(category) {
            const categoryMap = {
                'music': 'üéµ Music',
                'fps': 'üéØ FPS',
                'design': 'üé® Design',
                'development': 'üíª Dev',
                'productivity': '‚ö° Productivity',
                'gaming': 'üéÆ Gaming',
                'security': 'üîí Security',
                'other': 'üì¶ Other'
            };
            return categoryMap[category] || category || 'Other';
        }

        // Users Management (disabled - tab removed)
        function loadUsersData() {
            // Users tab has been removed from the dashboard
            console.log('Users tab functionality disabled - tab removed from dashboard');
            return;

            // Add current user if not in list (for initial setup/testing)
            if (currentUser.email && !users.find(u => u.email === currentUser.email)) {
                users.push({
                    ...currentUser,
                    name: currentUser.name || currentUser.given_name || 'New User',
                    joinDate: new Date().toISOString(),
                    totalPurchases: 0,
                    totalSpent: 0,
                    qualityPoints: 0,
                    isPremium: false,
                    lastActive: new Date().toISOString()
                });
                localStorage.setItem('registeredUsers', JSON.stringify(users));
                logSystemEvent(`Added current user ${currentUser.email} to user list`, 'info', 'loadUsersData', 'script.js');
            }

            // Update stats
            document.getElementById('totalUsersCount').textContent = users.length;
            document.getElementById('activeUsersCount').textContent = users.filter(u => isUserActive(u)).length;
            document.getElementById('premiumUsersCount').textContent = users.filter(u => u.isPremium).length;

            tableBody.innerHTML = '';

            if (users.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666; padding: 2rem;">No users found</td></tr>';
                return;
            }

            users.forEach(user => {
                const row = document.createElement('tr');
                const isActive = isUserActive(user);
                row.innerHTML = `
                    <td>
                        <div style="font-weight: 600; color: #fff;">${user.name || user.email}</div>
                        <div style="font-size: 0.8rem; color: #666;">${user.email}</div>
                    </td>
                    <td>
                        <span style="padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; background: ${isActive ? 'rgba(76, 175, 80, 0.2)' : 'rgba(255, 107, 107, 0.2)'}; color: ${isActive ? '#4CAF50' : '#ff6b6b'};">
                            ${isActive ? 'üü¢ Active' : 'üî¥ Inactive'}
                        </span>
                    </td>
                    <td>${user.totalPurchases || 0}</td>
                    <td>$${(user.totalSpent || 0).toFixed(2)}</td>
                    <td>${(user.qualityPoints || 0).toFixed(1)} QP</td>
                    <td>
                        <button onclick="viewUserDetails('${user.email}')" style="background: rgba(255, 215, 0, 0.2); border: 1px solid rgba(255, 215, 0, 0.3); color: #ffd700; padding: 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.5rem;">üëÅÔ∏è</button>
                        <button onclick="toggleUserPremium('${user.email}')" style="background: rgba(138, 43, 226, 0.2); border: 1px solid rgba(138, 43, 226, 0.3); color: #8a2be2; padding: 0.5rem; border-radius: 4px; cursor: pointer;">üëë</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function isUserActive(user) {
            if (!user.lastActive) return false;
            const lastActive = new Date(user.lastActive);
            const now = new Date();
            return (now - lastActive) < 30 * 60 * 1000; // Active if last seen within 30 minutes
        }

        function viewUserDetails(email) {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users.find(u => u.email === email);
            if (user) {
                alert(`User Details:\n\nName: ${user.name || 'N/A'}\nEmail: ${user.email}\nJoin Date: ${new Date(user.joinDate || Date.now()).toLocaleDateString()}\nTotal Purchases: ${user.totalPurchases || 0}\nTotal Spent: $${(user.totalSpent || 0).toFixed(2)}\nQuality Points: ${(user.qualityPoints || 0).toFixed(1)}\nPremium: ${user.isPremium ? 'Yes' : 'No'}`);
            } else {
                 logSystemEvent(`User details requested for non-existent user: ${email}`, 'warning', 'viewUserDetails', 'script.js');
            }
        }

        function toggleUserPremium(email) {
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const userIndex = users.findIndex(u => u.email === email);
            if (userIndex !== -1) {
                users[userIndex].isPremium = !users[userIndex].isPremium;
                localStorage.setItem('registeredUsers', JSON.stringify(users));
                loadUsersData();
                updateNavigationCounts();
                showToast(`User ${email} premium status updated!`, 'success');
                logSystemEvent(`Toggled premium status for user: ${email}`, 'info', 'toggleUserPremium', 'script.js');
            } else {
                logSystemEvent(`Attempted to toggle premium for non-existent user: ${email}`, 'error', 'toggleUserPremium', 'script.js');
            }
        }

        // Customers Management
        function loadCustomersData() {
            const grid = document.getElementById('userDetailsGrid');
            if (!grid) {
                console.error('Customer details grid not found!');
                logSystemEvent('Customer details grid not found', 'error', 'loadCustomersData', 'script.js');
                return;
            }

            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            grid.innerHTML = '';

            if (users.length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: #666; grid-column: 1 / -1; padding: 2rem;">No customer data found</div>';
                return;
            }

            users.forEach(user => {
                const card = document.createElement('div');
                card.style.cssText = `
                    background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(15, 15, 15, 0.8));
                    border: 1px solid rgba(255, 215, 0, 0.1);
                    border-radius: 16px;
                    padding: 2rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                `;

                card.addEventListener('mouseenter', () => {
                    card.style.borderColor = 'rgba(255, 215, 0, 0.3)';
                    card.style.transform = 'translateY(-5px)';
                });

                card.addEventListener('mouseleave', () => {
                    card.style.borderColor = 'rgba(255, 215, 0, 0.1)';
                    card.style.transform = 'translateY(0)';
                });

                card.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #ffd700, #ffed4e); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üë§</div>
                        <div>
                            <h3 style="color: #ffd700; margin: 0;">${user.name || 'Unknown User'}</h3>
                            <p style="color: #999; margin: 0.5rem 0 0 0;">${user.email}</p>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <span style="color: #666; font-size: 0.9rem;">Orders:</span>
                            <div style="color: #ffd700; font-weight: 600;">${user.totalPurchases || 0}</div>
                        </div>
                        <div>
                            <span style="color: #666; font-size: 0.9rem;">Spent:</span>
                            <div style="color: #4CAF50; font-weight: 600;">$${(user.totalSpent || 0).toFixed(2)}</div>
                        </div>
                        <div>
                            <span style="color: #666; font-size: 0.9rem;">Quality Points:</span>
                            <div style="color: #ff6b6b; font-weight: 600;">${(user.qualityPoints || 0).toFixed(1)} QP</div>
                        </div>
                        <div>
                            <span style="color: #666; font-size: 0.9rem;">Status:</span>
                            <div style="color: ${user.isPremium ? '#8a2be2' : '#ffd700'}; font-weight: 600;">${user.isPremium ? 'üëë Premium' : 'üîò Regular'}</div>
                        </div>
                    </div>
                `;

                card.addEventListener('click', () => viewUserDetails(user.email));
                grid.appendChild(card);
            });
        }

        // Contact Messages Management
        function loadContactSubmissions() {
            const tableBody = document.getElementById('contactsTableBody');
            if (!tableBody) {
                 console.error('Contacts table body not found!');
                 logSystemEvent('Contacts table body not found', 'error', 'loadContactSubmissions', 'script.js');
                 return;
            }

            const contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
            tableBody.innerHTML = '';

            if (contacts.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666; padding: 2rem;">No messages found</td></tr>';
                return;
            }

            contacts.forEach(contact => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(contact.date || Date.now()).toLocaleDateString()}</td>
                    <td>
                        <div style="font-weight: 600; color: #fff;">${contact.from_name || 'Anonymous'}</div>
                        <div style="font-size: 0.8rem; color: #666;">${contact.from_email || contact.email || 'N/A'}</div>
                    </td>
                    <td>${contact.subject || 'Contact Form Submission'}</td>
                    <td>
                        <span style="padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; background: ${contact.status === 'read' ? 'rgba(76, 175, 80, 0.2)' : 'rgba(255, 107, 107, 0.2)'}; color: ${contact.status === 'read' ? '#4CAF50' : '#ff6b6b'};">
                            ${contact.status === 'read' ? '‚úÖ Read' : 'üî¥ Unread'}
                        </span>
                    </td>
                    <td>
                        <button onclick="viewContactMessage('${contact.id}')" style="background: rgba(255, 215, 0, 0.2); border: 1px solid rgba(255, 215, 0, 0.3); color: #ffd700; padding: 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.5rem;">üëÅÔ∏è</button>
                        <button onclick="markContactAsRead('${contact.id}')" style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.3); color: #4CAF50; padding: 0.5rem; border-radius: 4px; cursor: pointer; margin-right: 0.5rem;">‚úÖ</button>
                        <button onclick="deleteContact('${contact.id}')" style="background: rgba(255, 107, 107, 0.2); border: 1px solid rgba(255, 107, 107, 0.3); color: #ff6b6b; padding: 0.5rem; border-radius: 4px; cursor: pointer;">üóëÔ∏è</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function viewContactMessage(contactId) {
            const contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
            const contact = contacts.find(c => c.id == contactId);
            if (contact) {
                alert(`Message Details:\n\nFrom: ${contact.from_name || 'Anonymous'}\nEmail: ${contact.from_email || contact.email || 'N/A'}\nDate: ${new Date(contact.date || Date.now()).toLocaleString()}\n\nMessage:\n${contact.message || 'No message content'}`);
            } else {
                logSystemEvent(`Contact message details requested for non-existent message ID: ${contactId}`, 'warning', 'viewContactMessage', 'script.js');
            }
        }

        function markContactAsRead(contactId) {
            let contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
            const contactIndex = contacts.findIndex(c => c.id == contactId);
            if (contactIndex !== -1) {
                contacts[contactIndex].status = 'read';
                localStorage.setItem('contactSubmissions', JSON.stringify(contacts));
                loadContactSubmissions();
                updateNavigationCounts();
                showToast('Message marked as read!', 'success');
                logSystemEvent(`Marked contact message as read: ${contactId}`, 'info', 'markContactAsRead', 'script.js');
            } else {
                logSystemEvent(`Attempted to mark non-existent contact message as read: ${contactId}`, 'error', 'markContactAsRead', 'script.js');
            }
        }

        function deleteContact(contactId) {
            if (confirm('Are you sure you want to delete this message?')) {
                let contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
                contacts = contacts.filter(c => c.id != contactId);
                localStorage.setItem('contactSubmissions', JSON.stringify(contacts));
                loadContactSubmissions();
                updateNavigationCounts();
                showToast('Message deleted!', 'success');
                logSystemEvent(`Deleted contact message: ${contactId}`, 'info', 'deleteContact', 'script.js');
            }
        }

        function clearContacts() {
            if (confirm('Are you sure you want to clear all messages?')) {
                localStorage.removeItem('contactSubmissions');
                loadContactSubmissions();
                updateNavigationCounts();
                showToast('All messages cleared!', 'success');
                logSystemEvent('All contact messages cleared', 'info', 'clearContacts', 'script.js');
            }
        }

        // Security Management
        function loadSecurityData() {
            const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
            const bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');

            document.getElementById('bannedUsersCount').textContent = bannedUsers.length;
            document.getElementById('bannedIPsCount').textContent = bannedIPs.length;
            document.getElementById('activeSessionsCount').textContent = users.filter(u => isUserActive(u)).length || 1;
            document.getElementById('securityAlerts').textContent = securityLog.filter(log => log.severity === 'warning' || log.severity === 'critical').length;

            // Load security log
            const securityLogDiv = document.getElementById('securityLog');
            if (securityLogDiv) {
                securityLogDiv.innerHTML = '';

                if (securityLog.length === 0) {
                    securityLogDiv.innerHTML = `
                        <div style="text-align: center; color: #666; padding: 2rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üîí</div>
                            <div>Security monitoring active</div>
                            <div style="font-size: 0.9rem; margin-top: 0.5rem;">No security events recorded</div>
                        </div>
                    `;
                } else {
                    securityLog.slice(0, 10).forEach(event => {
                        const eventDiv = document.createElement('div');
                        const severity = event.severity || 'info';
                        const severityColor = {
                            'critical': '#ff6b6b',
                            'warning': '#ffa500',
                            'info': '#ffd700',
                            'error': '#ff6b6b'
                        }[severity];

                        eventDiv.style.cssText = `
                            padding: 1rem;
                            margin-bottom: 0.5rem;
                            background: rgba(255, 215, 0, 0.05);
                            border-left: 3px solid ${severityColor};
                            border-radius: 8px;
                        `;

                        eventDiv.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.8rem; color: #666;">${new Date(event.timestamp).toLocaleString()}</span>
                                <span style="padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.7rem; background: rgba(${severityColor.substring(1)}, 0.2); color: ${severityColor};">
                                    ${severity}
                                </span>
                            </div>
                            <div style="color: #fff;">${event.message}</div>
                        `;

                        securityLogDiv.appendChild(eventDiv);
                    });
                }
            }
        }

        // Ban Management
        function loadBannedUsers() {
            const tableBody = document.getElementById('bannedUsersTable');
            if (!tableBody) {
                console.error('Banned users table body not found!');
                logSystemEvent('Banned users table body not found', 'error', 'loadBannedUsers', 'script.js');
                return;
            }

            const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
            tableBody.innerHTML = '';

            if (bannedUsers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666; padding: 2rem;">No banned users</td></tr>';
                return;
            }

            bannedUsers.forEach(user => {
                const row = document.createElement('tr');
                const userEmail = typeof user === 'string' ? user : user.email;
                const banDate = typeof user === 'object' ? user.date : new Date().toISOString();
                const reason = typeof user === 'object' ? user.reason : 'Legacy ban';
                const severity = typeof user === 'object' ? user.severity : 'medium';

                row.innerHTML = `
                    <td>${userEmail}</td>
                    <td>${reason}</td>
                    <td><span class="severity-badge severity-${severity}">${severity}</span></td>
                    <td>${new Date(banDate).toLocaleDateString()}</td>
                    <td>
                        <button onclick="unbanUser('${userEmail}')" style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.3); color: #4CAF50; padding: 0.5rem; border-radius: 4px; cursor: pointer;">Unban</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadBannedIPs() {
            const tableBody = document.getElementById('bannedIPsTable');
            if (!tableBody) {
                console.error('Banned IPs table body not found!');
                logSystemEvent('Banned IPs table body not found', 'error', 'loadBannedIPs', 'script.js');
                return;
            }

            const bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');
            tableBody.innerHTML = '';

            if (bannedIPs.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666; padding: 2rem;">No banned IPs</td></tr>';
                return;
            }

            bannedIPs.forEach(ip => {
                const row = document.createElement('tr');
                const ipAddress = typeof ip === 'string' ? ip : ip.ipAddress;
                const banDate = typeof ip === 'object' ? ip.date : new Date().toISOString();
                const reason = typeof ip === 'object' ? ip.reason : 'Legacy ban';
                const severity = typeof ip === 'object' ? ip.severity : 'medium';

                row.innerHTML = `
                    <td>${ipAddress}</td>
                    <td>${reason}</td>
                    <td><span class="severity-badge severity-${severity}">${severity}</span></td>
                    <td>${new Date(banDate).toLocaleDateString()}</td>
                    <td>
                        <button onclick="unbanIP('${ipAddress}')" style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.3); color: #4CAF50; padding: 0.5rem; border-radius: 4px; cursor: pointer;">Unban</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function banUser(email) {
            if (!email || !email.trim()) {
                email = document.getElementById('banEmailInput')?.value?.trim();
                if (!email) {
                    alert('Please enter a valid email address');
                    return;
                }
            }

            const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
            const isAlreadyBanned = bannedUsers.some(user => 
                (typeof user === 'string' && user === email) || 
                (typeof user === 'object' && user.email === email)
            );

            if (isAlreadyBanned) {
                alert('User is already banned');
                return;
            }

            const banData = {
                email: email,
                date: new Date().toISOString(),
                reason: 'Admin action'
            };

            bannedUsers.push(banData);
            localStorage.setItem('bannedUsers', JSON.stringify(bannedUsers));

            loadBannedUsers();
            loadSecurityData();
            showToast(`User ${email} has been banned`, 'success');
            logSystemEvent(`User banned: ${email}`, 'info', 'banUser', 'script.js');
        }

        function unbanUser(email) {
            if (confirm(`Are you sure you want to unban ${email}?`)) {
                let bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
                bannedUsers = bannedUsers.filter(user => {
                    return !(
                        (typeof user === 'string' && user === email) || 
                        (typeof user === 'object' && user.email === email)
                    );
                });
                localStorage.setItem('bannedUsers', JSON.stringify(bannedUsers));
                loadBannedUsers();
                loadSecurityData();
                showToast(`User ${email} has been unbanned`, 'success');
                logSystemEvent(`User unbanned: ${email}`, 'info', 'unbanUser', 'script.js');
            }
        }

        function banIP(ipAddress) {
            if (!ipAddress || !ipAddress.trim()) {
                ipAddress = document.getElementById('banIPInput')?.value?.trim();
                if (!ipAddress) {
                    alert('Please enter a valid IP address');
                    return;
                }
            }

            const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!ipRegex.test(ipAddress)) {
                alert('Please enter a valid IP address format');
                return;
            }

            const bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');
            const isAlreadyBanned = bannedIPs.some(ip => 
                (typeof ip === 'string' && ip === ipAddress) || 
                (typeof ip === 'object' && ip.ipAddress === ipAddress)
            );

            if (isAlreadyBanned) {
                alert('IP address is already banned');
                return;
            }

            const banData = {
                ipAddress: ipAddress,
                date: new Date().toISOString(),
                reason: 'Admin action'
            };

            bannedIPs.push(banData);
            localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));

            loadBannedIPs();
            loadSecurityData();
            showToast(`IP ${ipAddress} has been banned`, 'success');
            logSystemEvent(`IP banned: ${ipAddress}`, 'info', 'banIP', 'script.js');
        }

        function unbanIP(ipAddress) {
            if (confirm(`Are you sure you want to unban ${ipAddress}?`)) {
                let bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');
                bannedIPs = bannedIPs.filter(ip => {
                    return !(
                        (typeof ip === 'string' && ip === ipAddress) || 
                        (typeof ip === 'object' && ip.ipAddress === ipAddress)
                    );
                });
                localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));
                loadBannedIPs();
                loadSecurityData();
                showToast(`IP ${ipAddress} has been unbanned`, 'success');
                logSystemEvent(`IP unbanned: ${ipAddress}`, 'info', 'unbanIP', 'script.js');
            }
        }

        // Console Management
        function loadConsoleTab() {
            const consoleContainer = document.getElementById('consoleContainer');
            const logStats = document.getElementById('logStats');

            if (!consoleContainer) {
                console.error('Console container not found!');
                logSystemEvent('Console container not found', 'error', 'loadConsoleTab', 'script.js');
                return;
            }

            const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');
            const systemLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const allLogs = [...securityLog, ...systemLogs].sort((a, b) => 
                new Date(b.timestamp || b.date || Date.now()) - new Date(a.timestamp || a.date || Date.now())
            );

            // Update statistics
            if (logStats) {
                const errorCount = allLogs.filter(log => (log.severity || log.level) === 'error').length;
                const warningCount = allLogs.filter(log => (log.severity || log.level) === 'warning').length;
                const infoCount = allLogs.filter(log => (log.severity || log.level) === 'info').length;

                logStats.innerHTML = `
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(15, 15, 15, 0.8)); border: 1px solid rgba(255, 215, 0, 0.1); border-radius: 16px; padding: 2rem;">
                        <h4 style="color: #ffd700; margin-bottom: 1rem;">üìä System Statistics</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: 700; color: #ffd700;">${allLogs.length}</div>
                                <div style="color: #999; font-size: 0.9rem;">Total Events</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: 700; color: #ff6b6b;">${errorCount}</div>
                                <div style="color: #999; font-size: 0.9rem;">Errors</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: 700; color: #ffa500;">${warningCount}</div>
                                <div style="color: #999; font-size: 0.9rem;">Warnings</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: 700; color: #4CAF50;">${infoCount}</div>
                                <div style="color: #999; font-size: 0.9rem;">Info</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Display logs
            consoleContainer.innerHTML = '';

            if (allLogs.length === 0) {
                consoleContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üñ•Ô∏è</div>
                        <div>System Console Active</div>
                        <div style="font-size: 0.9rem; margin-top: 0.5rem;">No system events recorded yet</div>
                    </div>
                `;
                return;
            }

            allLogs.slice(0, 50).forEach(log => {
                const logEntry = document.createElement('div');
                const level = log.severity || log.level || 'info';
                const levelColors = {
                    'error': '#ff6b6b',
                    'warning': '#ffa500',
                    'info': '#4CAF50',
                    'critical': '#ff0000'
                };

                logEntry.style.cssText = `
                    padding: 1rem;
                    margin-bottom: 0.5rem;
                    background: rgba(0, 0, 0, 0.5);
                    border-left: 3px solid ${levelColors[level] || '#4CAF50'};
                    border-radius: 4px;
                    font-family: 'JetBrains Mono', monospace;
                    font-size: 0.9rem;
                `;

                logEntry.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="color: #666; font-size: 0.8rem;">[${new Date(log.timestamp || log.date || Date.now()).toLocaleString()}]</span>
                        <span style="color: ${levelColors[level] || '#4CAF50'}; font-weight: 600; text-transform: uppercase;">${level}</span>
                    </div>
                    <div style="color: #fff;">${log.message}</div>
                    ${log.function ? `<div style="color: #666; font-size: 0.8rem; margin-top: 0.25rem;">Function: ${log.function}</div>` : ''}
                `;

                consoleContainer.appendChild(logEntry);
            });
        }

        function clearSystemLogs() {
            if (confirm('Are you sure you want to clear all system logs?')) {
                localStorage.removeItem('systemLogs');
                localStorage.removeItem('securityLog');
                loadConsoleTab();
                showToast('System logs cleared!', 'success');
                logSystemEvent('System logs cleared', 'info', 'clearSystemLogs', 'script.js');
            }
        }

        function exportSystemLogs() {
            const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');
            const systemLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const allLogs = [...securityLog, ...systemLogs];

            const exportData = {
                exportedAt: new Date().toISOString(),
                totalLogs: allLogs.length,
                logs: allLogs
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `system_logs_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);

            showToast('System logs exported!', 'success');
            logSystemEvent('System logs exported', 'info', 'exportSystemLogs', 'script.js');
        }

        // Update navigation counts
        function updateNavigationCounts() {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');

            const productsCountEl = document.getElementById('productsCount');
            if (productsCountEl) productsCountEl.textContent = products.length;

            const usersCountEl = document.getElementById('usersCount');
            if (usersCountEl) usersCountEl.textContent = users.length;

            const contactsCountEl = document.getElementById('contactsCount');
            if (contactsCountEl) contactsCountEl.textContent = contacts.filter(c => c.status !== 'read').length;
        }

        // Load analytics data
        function loadAnalytics() {
            try {
                updateAnalyticsMetrics();
                initCharts();
                logSystemEvent('Analytics loaded', 'info', 'loadAnalytics', 'script.js');
            } catch (error) {
                console.error('Error loading analytics:', error);
                logSystemEvent(`Error loading analytics: ${error.message}`, 'error', 'loadAnalytics', 'script.js');
            }
        }

        function updateAnalyticsMetrics() {
            try {
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
                const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');

                // Calculate REAL metrics from actual data
                const totalViews = products.reduce((sum, product) => sum + (product.views || 0), 0);
                const totalOrders = transactions.length;
                // Use actual PayPal transaction data for real revenue
                const totalRevenue = transactions.reduce((sum, transaction) => sum + (transaction.amount || 0), 0);
                const conversionRate = totalViews > 0 ? ((totalOrders / totalViews) * 100).toFixed(2) : '0.00';

                // Calculate percentage changes (compare with previous period)
                const previousStats = JSON.parse(localStorage.getItem('previousStats') || '{}');
                const revenueChange = previousStats.revenue ? 
                    (((totalRevenue - previousStats.revenue) / previousStats.revenue) * 100).toFixed(1) : '0';
                const viewsChange = previousStats.views ? 
                    (((totalViews - previousStats.views) / previousStats.views) * 100).toFixed(1) : '0';
                const ordersChange = previousStats.orders ? 
                    (((totalOrders - previousStats.orders) / previousStats.orders) * 100).toFixed(1) : '0';
                const conversionRateChange = previousStats.conversion ? 
                    (parseFloat(conversionRate) - parseFloat(previousStats.conversion)).toFixed(1) : '0';

                // Update UI elements with REAL data
                document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
                document.getElementById('totalViews').textContent = totalViews.toLocaleString();
                document.getElementById('totalOrders').textContent = totalOrders.toLocaleString();
                document.getElementById('conversionRate').textContent = `${conversionRate}%`;

                // Update change indicators
                updateChangeIndicator('revenueChange', revenueChange);
                updateChangeIndicator('viewsChange', viewsChange);
                updateChangeIndicator('ordersChange', ordersChange);
                updateChangeIndicator('conversionChange', conversionRateChange);

                // Store current stats for next comparison
                localStorage.setItem('previousStats', JSON.stringify({
                    revenue: totalRevenue,
                    views: totalViews,
                    orders: totalOrders,
                    conversion: conversionRate
                }));

            } catch (error) {
                console.error('Error updating analytics metrics:', error);
                logSystemEvent(`Error updating analytics metrics: ${error.message}`, 'error', 'updateAnalyticsMetrics', 'script.js');
            }
        }

        function updateChangeIndicator(elementId, change) {
            const element = document.getElementById(elementId);
            if (element) {
                const changeValue = parseFloat(change);
                element.textContent = `${changeValue >= 0 ? '+' : ''}${change}%`;
                element.className = 'stat-change ' + (changeValue >= 0 ? 'positive' : 'negative');
            }
        }

        function initCharts() {
            // Placeholder for chart initialization, actual chart logic is in initSalesChart
        }

        function initSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) {
                console.error('Sales chart canvas not found!');
                logSystemEvent('Sales chart canvas not found', 'error', 'initSalesChart', 'script.js');
                return;
            }
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded!');
                logSystemEvent('Chart.js not loaded', 'error', 'initSalesChart', 'script.js');
                return;
            }

            const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            const salesDataForChart = [...purchases, ...transactions]; // Combine data for chart

            const last6Months = [];
            const salesData = [];
            const currentDate = new Date();

            for (let i = 5; i >= 0; i--) {
                const month = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const monthName = month.toLocaleString('default', { month: 'short' });
                last6Months.push(monthName);

                const monthSales = salesDataForChart.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate.getMonth() === month.getMonth() && 
                           saleDate.getFullYear() === month.getFullYear();
                }).length;

                salesData.push(monthSales);
            }

            // Clear any existing chart
            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last6Months,
                    datasets: [{
                        label: 'Sales',
                        data: salesData,
                        borderColor: '#ffd700',
                        backgroundColor: 'rgba(255, 215, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: '#333' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: '#333' }
                        }
                    }
                }
            });
            logSystemEvent('Sales chart initialized', 'info', 'initSalesChart', 'script.js');
        }

        // Toast notification system
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            // Ensure a container exists
            if (!toastContainer) {
                const container = document.createElement('div');
                container.id = 'toast-container';
                container.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                `;
                document.body.appendChild(container);
            }

            const toast = document.createElement('div');
            toast.style.cssText = `
                padding: 1rem 1.5rem;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#ff6b6b' : '#ffd700'};
                color: ${type === 'success' || type === 'error' ? '#fff' : '#000'};
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                font-weight: 600;
                transform: translateX(100%);
                opacity: 0;
                transition: transform 0.3s ease, opacity 0.3s ease;
            `;
            toast.textContent = message;

            document.getElementById('toast-container').appendChild(toast);

            // Trigger animation
            requestAnimationFrame(() => {
                toast.style.transform = 'translateX(0)';
                toast.style.opacity = '1';
            });

            // Auto-remove toast after a delay
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                toast.style.opacity = '0';
                toast.addEventListener('transitionend', () => {
                    toast.remove();
                });
            }, 3000);
        }

        // Global Data Synchronization and Management
        window.globalDataManager = {
            // Centralized data refresh function
            refreshAllData: function() {
                this.syncProducts();
                this.syncUsers();
                this.syncMessages();
                this.syncSecurity();
                this.updateAllCounts();
                console.log('üîÑ All dashboard data refreshed');
                logSystemEvent('Dashboard data refreshed', 'info', 'refreshAllData', 'script.js');
            },

            // Sync products data
            syncProducts: function() {
                const products = window.safeLocalStorageParse ? window.safeLocalStorageParse('products', []) : JSON.parse(localStorage.getItem('products') || '[]');
                window.dashboardData = window.dashboardData || {};
                window.dashboardData.products = products;
                if (typeof loadProductsTable === 'function') loadProductsTable();
                return products;
            },

            // Sync users data
            syncUsers: function() {
                try {
                    const rawData = localStorage.getItem('registeredUsers') || '[]';
                    // Check for corrupted data
                    if (rawData.startsWith('JTVCJTdCJT') || rawData.includes('%')) {
                        console.warn('Detected corrupted registeredUsers data, resetting...');
                        localStorage.removeItem('registeredUsers');
                        const users = [];
                        window.dashboardData = window.dashboardData || {};
                        window.dashboardData.users = users;
                        return users;
                    }
                    const users = JSON.parse(rawData);
                    window.dashboardData = window.dashboardData || {};
                    window.dashboardData.users = users;
                    if (typeof loadUsersData === 'function') loadUsersData();
                    return users;
                } catch (error) {
                    console.error('Error syncing users:', error);
                    localStorage.removeItem('registeredUsers');
                    const users = [];
                    window.dashboardData = window.dashboardData || {};
                    window.dashboardData.users = users;
                    return users;
                }
            },

            // Sync messages data
            syncMessages: function() {
                const messages = window.safeLocalStorageParse ? window.safeLocalStorageParse('contactSubmissions', []) : JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
                window.dashboardData = window.dashboardData || {};
                window.dashboardData.messages = messages;
                if (typeof loadContactSubmissions === 'function') loadContactSubmissions();
                return messages;
            },

            // Sync security data
            syncSecurity: function() {
                const securityLog = window.safeLocalStorageParse ? window.safeLocalStorageParse('securityLog', []) : JSON.parse(localStorage.getItem('securityLog') || '[]');
                const bannedUsers = window.safeLocalStorageParse ? window.safeLocalStorageParse('bannedUsers', []) : JSON.parse(localStorage.getItem('bannedUsers') || '[]');
                const bannedIPs = window.safeLocalStorageParse ? window.safeLocalStorageParse('bannedIPs', []) : JSON.parse(localStorage.getItem('bannedIPs') || '[]');

                window.dashboardData = window.dashboardData || {};
                window.dashboardData.security = {
                    log: securityLog,
                    bannedUsers: bannedUsers,
                    bannedIPs: bannedIPs
                };

                if (typeof loadSecurityData === 'function') loadSecurityData();
                if (typeof loadBannedUsers === 'function') loadBannedUsers();
                if (typeof loadBannedIPs === 'function') loadBannedIPs();
                if (typeof loadConsoleTab === 'function') loadConsoleTab();

                return window.dashboardData.security;
            },

            // Update all navigation counts
            updateAllCounts: function() {
                const products = this.syncProducts();
                const users = this.syncUsers();
                const messages = this.syncMessages();

                const productsCountEl = document.getElementById('productsCount');
                if (productsCountEl) productsCountEl.textContent = products.length;

                const usersCountEl = document.getElementById('usersCount');
                if (usersCountEl) usersCountEl.textContent = users.length;

                const contactsCountEl = document.getElementById('contactsCount');
                if (contactsCountEl) contactsCountEl.textContent = messages.filter(m => m.status !== 'read').length;
            },

            // Get real-time statistics
            getGlobalStats: function() {
                const products = this.syncProducts();
                const users = this.syncUsers();
                const messages = this.syncMessages();
                const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
                const security = this.syncSecurity();

                return {
                    products: {
                        total: products.length,
                        featured: products.filter(p => p.featured).length,
                        totalViews: products.reduce((sum, p) => sum + (p.views || 0), 0)
                    },
                    users: {
                        total: users.length,
                        premium: users.filter(u => u.isPremium).length,
                        active: users.filter(u => this.isUserActive(u)).length
                    },
                    messages: {
                        total: messages.length,
                        unread: messages.filter(m => m.status !== 'read').length
                    },
                    revenue: {
                        total: purchases.reduce((sum, p) => sum + (p.finalTotal || 0), 0),
                        orders: purchases.length
                    },
                    security: {
                        totalEvents: security.log.length,
                        bannedUsers: security.bannedUsers.length,
                        bannedIPs: security.bannedIPs.length,
                        criticalEvents: security.log.filter(e => e.severity === 'critical').length
                    }
                };
            },

            // Check if user is active (within last 30 minutes)
            isUserActive: function(user) {
                if (!user.lastActive) return false;
                const lastActiveTime = new Date(user.lastActive);
                const now = new Date();
                return (now - lastActiveTime) < 30 * 60 * 1000;
            }
        };

        // Make data manager globally available
        window.globalData = window.globalDataManager.getGlobalStats();

        // Auto-refresh data every 30 seconds
        setInterval(() => {
            window.globalDataManager.refreshAllData();
            window.globalData = window.globalDataManager.getGlobalStats();
        }, 30000);

        // Initialize everything
        window.globalDataManager.refreshAllData();
        updateNavigationCounts();

        // Auto-refresh products table every 5 seconds to keep it in sync
        setInterval(() => {
            if (document.querySelector('.sidebar-nav-link[data-tab="products"]').classList.contains('active')) {
                loadProductsTable();
            }
        }, 5000);

        // Update admin name
        const adminNameHeader = document.getElementById('adminNameHeader');
        const adminUser = JSON.parse(localStorage.getItem('user') || '{}');
        if (adminNameHeader && adminUser.name) {
            adminNameHeader.textContent = adminUser.given_name || adminUser.name || 'Administrator';
        } else if (adminNameHeader) {
             logSystemEvent('User data not found for admin name header', 'warning', 'DOMContentLoaded', 'script.js');
        }

        // Make global functions accessible
        window.refreshDashboard = function() {
            window.globalDataManager.refreshAllData();
            showToast('Dashboard data refreshed!', 'success');
        };

        // Add keyboard shortcuts for dashboard
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) { // Check for Ctrl or Cmd key
                switch(e.key.toLowerCase()) { // Use lower case for key comparison
                    case 'r':
                        e.preventDefault();
                        window.refreshDashboard();
                        break;
                    case 'e':
                        e.preventDefault();
                        window.exportUsers();
                        break;
                    case 'n':
                        e.preventDefault();
                        window.addNewProduct();
                        break;
                    case 'p': // Shortcut for "Products" tab
                        e.preventDefault();
                        document.querySelector('.sidebar-nav-link[data-tab="products"]').click();
                        break;
                    case 'a': // Shortcut for "Analytics" tab
                        e.preventDefault();
                        document.querySelector('.sidebar-nav-link[data-tab="analytics"]').click();
                        break;
                }
            }
        });

        // Add some sample data if none exists
        function initializeSampleData() {
            const localStorageKeys = ['products', 'contactSubmissions', 'securityLog', 'registeredUsers', 'bannedUsers', 'bannedIPs', 'purchases', 'systemLogs'];
            let needsInitialization = false;
            localStorageKeys.forEach(key => {
                if (localStorage.getItem(key) === null) {
                    needsInitialization = true;
                }
            });

            if (!needsInitialization) {
                console.log('Sample data already exists.');
                return;
            }

            console.log('Initializing sample data...');

            // Add sample products if none exist
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            if (products.length === 0) {
                const sampleProducts = [
                    {
                        id: '1',
                        title: 'Music Production Suite',
                        price: '$29.99',
                        originalPrice: '$39.99',
                        discount: 25,
                        category: 'music',
                        description: 'Complete music production toolkit with premium sounds and effects. Includes virtual instruments, VST plugins, and royalty-free samples.',
                        views: 45,
                        dateCreated: new Date().toISOString(),
                        image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=' // Placeholder image
                    },
                    {
                        id: '2',
                        title: 'FPS Gaming Config',
                        price: '$19.99',
                        originalPrice: '$24.99',
                        discount: 20,
                        category: 'fps',
                        description: 'Optimized gaming configurations for competitive FPS games. Boost your frame rates and reduce input lag.',
                        views: 23,
                        dateCreated: new Date().toISOString(),
                        image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=' // Placeholder image
                    },
                    {
                        id: '3',
                        title: 'Advanced UI Design Kit',
                        price: '$49.99',
                        category: 'design',
                        description: 'High-fidelity UI components for modern web and mobile applications. Save time with pre-built, customizable elements.',
                        views: 15,
                        dateCreated: new Date().toISOString(),
                        image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=' // Placeholder image
                    }
                ];
                localStorage.setItem('products', JSON.stringify(sampleProducts));
                console.log('Added sample products.');
            }

            // Add sample contacts if none exist
            const contacts = JSON.parse(localStorage.getItem('contactSubmissions') || '[]');
            if (contacts.length === 0) {
                const sampleContacts = [
                    {
                        id: Date.now().toString(),
                        from_name: 'John Doe',
                        from_email: 'john@example.com',
                        subject: 'Product Inquiry',
                        message: 'I\'m interested in your music production suite. Can you provide more details about the included VST plugins?',
                        date: new Date().toISOString(),
                        status: 'unread'
                    },
                    {
                        id: (Date.now() + 1).toString(),
                        from_name: 'Jane Smith',
                        from_email: 'jane@sample.net',
                        subject: 'Feedback on Dashboard',
                        message: 'The new dashboard looks great! Very intuitive and the performance metrics are very helpful.',
                        date: new Date(Date.now() - 86400000).toISOString(), // Yesterday
                        status: 'read'
                    }
                ];
                localStorage.setItem('contactSubmissions', JSON.stringify(sampleContacts));
                console.log('Added sample contacts.');
            }

            // Add sample security log if none exist
            const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');
            if (securityLog.length === 0) {
                const sampleLogs = [
                    {
                        message: 'Dashboard system initialized successfully',
                        severity: 'info',
                        timestamp: new Date().toISOString()
                    },
                    {
                        message: 'Admin user authentication verified',
                        severity: 'info',
                        timestamp: new Date(Date.now() - 60000).toISOString() // 1 minute ago
                    }
                ];
                localStorage.setItem('securityLog', JSON.stringify(sampleLogs));
                console.log('Added sample security logs.');
            }

            // Add sample users if none exist
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            if (users.length === 0) {
                const sampleUsers = [
                    {
                        email: 'testuser@example.com',
                        name: 'Test User',
                        joinDate: new Date(Date.now() - 86400000 * 7).toISOString(), // 1 week ago
                        totalPurchases: 5,
                        totalSpent: 150.75,
                        qualityPoints: 85.2,
                        isPremium: true,
                        lastActive: new Date().toISOString()
                    },
                    {
                        email: 'regularuser@sample.org',
                        name: 'Regular User',
                        joinDate: new Date(Date.now() - 86400000 * 3).toISOString(), // 3 days ago
                        totalPurchases: 2,
                        totalSpent: 45.50,
                        qualityPoints: 60.0,
                        isPremium: false,
                        lastActive: new Date(Date.now() - 3600000).toISOString() // 1 hour ago
                    }
                ];
                localStorage.setItem('registeredUsers', JSON.stringify(sampleUsers));
                console.log('Added sample users.');
            }

            // Add sample purchases if none exist
            const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
            if (purchases.length === 0) {
                const samplePurchases = [
                    {
                        id: 'p1',
                        userId: 'testuser@example.com',
                        productId: '1',
                        date: new Date(Date.now() - 86400000 * 2).toISOString(), // 2 days ago
                        quantity: 1,
                        pricePerItem: 29.99,
                        discountApplied: 0,
                        finalTotal: 29.99
                    },
                    {
                        id: 'p2',
                        userId: 'regularuser@sample.org',
                        productId: '2',
                        date: new Date(Date.now() - 86400000 * 5).toISOString(), // 5 days ago
                        quantity: 1,
                        pricePerItem: 19.99,
                        discountApplied: 0,
                        finalTotal: 19.99
                    }
                ];
                localStorage.setItem('purchases', JSON.stringify(samplePurchases));
                console.log('Added sample purchases.');
            }

             // Add sample banned users/IPs if none exist
            const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
            if (bannedUsers.length === 0) {
                localStorage.setItem('bannedUsers', JSON.stringify([{ email: 'banned@example.com', date: new Date().toISOString() }]));
                console.log('Added sample banned user.');
            }
            const bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');
            if (bannedIPs.length === 0) {
                localStorage.setItem('bannedIPs', JSON.stringify([{ ipAddress: '192.168.1.100', date: new Date().toISOString() }]));
                console.log('Added sample banned IP.');
            }

            console.log('Sample data initialization complete.');
            // Refresh data after initialization
            window.globalDataManager.refreshAllData();
        }

        // Initialize sample data on first load
        initializeSampleData();

        // Placeholder functions for external scripts (if any)
        function signOut() {
            alert('Sign out functionality not implemented.');
            logSystemEvent('Sign out function called but not implemented', 'warning', 'signOut', 'script.js');
        }
        // Enhanced ban management functions
        function banUser(email) { 
            if (window.banUser) {
                window.banUser(email);
            } else {
                console.warn("banUser function not available yet");
            }
        }
        function banIP(ipAddress) { 
            if (window.banIP) {
                window.banIP(ipAddress);
            } else {
                console.warn("banIP function not available yet");
            }
        }
        function unbanUser(email) { 
            if (window.unbanUser) {
                window.unbanUser(email);
            } else {
                console.warn("unbanUser function not available yet");
            }
        }
        function unbanIP(ipAddress) { 
            if (window.unbanIP) {
                window.unbanIP(ipAddress);
            } else {
                console.warn("unbanIP function not available yet");
            }
        }
        // Enhanced ban management functions
        function banUserWithReason(email, reason) {
            if (!email || !email.trim()) {
                alert('Please enter a valid email address');
                return;
            }

            if (!reason) reason = 'Admin action';

            const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
            const isAlreadyBanned = bannedUsers.some(user => 
                (typeof user === 'string' && user === email) || 
                (typeof user === 'object' && user.email === email)
            );

            if (isAlreadyBanned) {
                alert('User is already banned');
                return;
            }

            const banData = {
                email: email,
                date: new Date().toISOString(),
                reason: reason,
                severity: 'high',
                banType: 'Manual',
                banId: 'MANUAL-' + Date.now()
            };

            bannedUsers.push(banData);
            localStorage.setItem('bannedUsers', JSON.stringify(bannedUsers));

            // Ban system disabled
            // if (window.banSystem) {
            //     window.banSystem.addSecurityEvent(`Admin manually banned user: ${email} - Reason: ${reason}`, 'warning');
            // }

            loadBannedUsers();
            loadSecurityData();
            showToast(`User ${email} has been banned`, 'success');
            logSystemEvent(`User banned: ${email} - Reason: ${reason}`, 'info', 'banUser', 'script.js');
        }

        function banIPWithReason(ipAddress, reason) {
            if (!ipAddress || !ipAddress.trim()) {
                alert('Please enter a valid IP address');
                return;
            }

            const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (!ipRegex.test(ipAddress)) {
                alert('Please enter a valid IP address format');
                return;
            }

            if (!reason) reason = 'Admin action';

            const bannedIPs = JSON.parse(localStorage.getItem('bannedIPs') || '[]');
            const isAlreadyBanned = bannedIPs.some(ip => 
                (typeof ip === 'string' && ip === ipAddress) || 
                (typeof ip === 'object' && ip.ipAddress === ipAddress)
            );

            if (isAlreadyBanned) {
                alert('IP address is already banned');
                return;
            }

            const banData = {
                ipAddress: ipAddress,
                date: new Date().toISOString(),
                reason: reason,
                severity: 'high',
                banType: 'Manual'
            };

            bannedIPs.push(banData);
            localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));

            // Ban system disabled
            // if (window.banSystem) {
            //     window.banSystem.addSecurityEvent(`Admin manually banned IP: ${ipAddress} - Reason: ${reason}`, 'warning');
            // }

            loadBannedIPs();
            loadSecurityData();
            showToast(`IP ${ipAddress} has been banned`, 'success');
            logSystemEvent(`IP banned: ${ipAddress} - Reason: ${reason}`, 'info', 'banIP', 'script.js');
        }

        function banDevice(fingerprint) {
            if (!fingerprint || !fingerprint.trim()) {
                alert('Please enter a valid device fingerprint');
                return;
            }

            const bannedDevices = JSON.parse(localStorage.getItem('bannedDevices') || '[]');
            const isAlreadyBanned = bannedDevices.some(device => device.fingerprint === fingerprint);

            if (isAlreadyBanned) {
                alert('Device is already banned');
                return;
            }

            const banData = {
                fingerprint: fingerprint,
                date: new Date().toISOString(),
                reason: 'Admin device ban',
                severity: 'critical'
            };

            bannedDevices.push(banData);
            localStorage.setItem('bannedDevices', JSON.stringify(bannedDevices));

            // Ban system disabled
            // if (window.banSystem) {
            //     window.banSystem.addSecurityEvent(`Admin manually banned device: ${fingerprint.substring(0, 16)}...`, 'critical');
            // }

            showToast('Device has been banned', 'success');
            logSystemEvent(`Device banned: ${fingerprint.substring(0, 16)}...`, 'info', 'banDevice', 'script.js');
        }

        function viewSuspiciousActivity() {
            const suspiciousData = [];
            
            // Ban system disabled
            // if (window.banSystem && window.banSystem.suspiciousActivities) {
            //     suspiciousData.push(...window.banSystem.suspiciousActivities);
            // }

            const securityLog = JSON.parse(localStorage.getItem('securityLog') || '[]');
            const suspiciousEvents = securityLog.filter(event => 
                event.message.toLowerCase().includes('suspicious') || 
                event.message.toLowerCase().includes('threat') ||
                event.severity === 'critical'
            );
            suspiciousData.push(...suspiciousEvents);

            if (suspiciousData.length === 0) {
                alert('No suspicious activity detected');
                return;
            }

            const activityText = suspiciousData.slice(0, 10).map(activity => {
                const timestamp = new Date(activity.timestamp || activity.date || Date.now()).toLocaleString();
                const type = activity.type || activity.message || 'Unknown';
                const severity = activity.severity || 'medium';
                return `[${timestamp}] ${severity.toUpperCase()}: ${type}`;
            }).join('\n');

            alert(`üö® Recent Suspicious Activity:\n\n${activityText}\n\nShowing last 10 activities`);
        }

        function clearAllBans() {
            if (confirm('Are you sure you want to clear ALL bans? This action cannot be undone.')) {
                localStorage.removeItem('bannedUsers');
                localStorage.removeItem('bannedIPs');
                localStorage.removeItem('bannedDevices');
                
                loadBannedUsers();
                loadBannedIPs();
                loadSecurityData();
                
                showToast('All bans have been cleared', 'success');
                logSystemEvent('All bans cleared by admin', 'warning', 'clearAllBans', 'script.js');
                
                // Ban system disabled
                // if (window.banSystem) {
                //     window.banSystem.addSecurityEvent('Admin cleared all bans', 'warning');
                // }
            }
        }

        // ===== NEW SECURE BAN SYSTEM FUNCTIONS =====
        
        // Advanced secure email ban function
        function addSecureEmailBan() {
            const email = document.getElementById('secureEmailBanInput').value.trim();
            const reason = document.getElementById('secureEmailBanReason').value;
            
            if (!email) {
                showToast('Please enter a valid email address', 'error');
                return;
            }
            
            if (window.SecureBanSystem) {
                try {
                    const result = window.SecureBanSystem.addEmailBan(email, reason);
                    if (result.success) {
                        showToast(`Email ${email} has been securely banned`, 'success');
                        document.getElementById('secureEmailBanInput').value = '';
                        refreshSecureBanData();
                        
                        // Log to secure logger
                        if (window.SecureLogger) {
                            window.SecureLogger.logSecure('admin_email_ban', {
                                email: email,
                                reason: reason,
                                timestamp: new Date().toISOString(),
                                admin: 'dashboard_user'
                            });
                        }
                    } else {
                        showToast(result.message || 'Failed to ban email', 'error');
                    }
                } catch (error) {
                    console.error('Error adding email ban:', error);
                    showToast('Error adding email ban', 'error');
                }
            } else {
                showToast('Secure ban system not available', 'error');
            }
        }
        
        // Advanced secure IP ban function
        function addSecureIPBan() {
            const ip = document.getElementById('secureIPBanInput').value.trim();
            const type = document.getElementById('secureIPBanType').value;
            const reason = document.getElementById('secureIPBanReason').value;
            
            if (!ip) {
                showToast('Please enter a valid IP address', 'error');
                return;
            }
            
            if (window.SecureBanSystem) {
                try {
                    const result = window.SecureBanSystem.addIPBan(ip, reason, type);
                    if (result.success) {
                        showToast(`IP ${ip} has been securely banned`, 'success');
                        document.getElementById('secureIPBanInput').value = '';
                        refreshSecureBanData();
                        
                        // Log to secure logger
                        if (window.SecureLogger) {
                            window.SecureLogger.logSecure('admin_ip_ban', {
                                ip: ip,
                                type: type,
                                reason: reason,
                                timestamp: new Date().toISOString(),
                                admin: 'dashboard_user'
                            });
                        }
                    } else {
                        showToast(result.message || 'Failed to ban IP', 'error');
                    }
                } catch (error) {
                    console.error('Error adding IP ban:', error);
                    showToast('Error adding IP ban', 'error');
                }
            } else {
                showToast('Secure ban system not available', 'error');
            }
        }
        
        // Refresh secure ban data and update UI
        function refreshSecureBanData() {
            if (window.SecureBanSystem) {
                try {
                    // Update email bans table
                    const emailBans = window.SecureBanSystem.getEmailBans();
                    const emailTableBody = document.getElementById('secureBannedEmailsTable');
                    if (emailTableBody) {
                        if (emailBans.length === 0) {
                            emailTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666; padding: 2rem;">No banned emails - System is secure</td></tr>';
                        } else {
                            emailTableBody.innerHTML = emailBans.map(ban => `
                                <tr>
                                    <td style="color: #ff3333;">${ban.email}</td>
                                    <td style="color: #ff3333;">${ban.reason}</td>
                                    <td style="color: #ff3333;">${new Date(ban.timestamp).toLocaleDateString()}</td>
                                    <td>
                                        <button onclick="removeSecureEmailBan('${ban.email}')" style="background: #ff6b6b; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">Remove</button>
                                    </td>
                                </tr>
                            `).join('');
                        }
                    }
                    
                    // Update IP bans table
                    const ipBans = window.SecureBanSystem.getIPBans();
                    const ipTableBody = document.getElementById('secureBannedIPsTable');
                    if (ipTableBody) {
                        if (ipBans.length === 0) {
                            ipTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666; padding: 2rem;">No banned IPs - System is protected</td></tr>';
                        } else {
                            ipTableBody.innerHTML = ipBans.map(ban => `
                                <tr>
                                    <td style="color: #ff6b6b;">${ban.ip}</td>
                                    <td style="color: #ff6b6b;">${ban.type || 'single'}</td>
                                    <td style="color: #ff6b6b;">${ban.reason}</td>
                                    <td>
                                        <button onclick="removeSecureIPBan('${ban.ip}')" style="background: #ff6b6b; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">Remove</button>
                                    </td>
                                </tr>
                            `).join('');
                        }
                    }
                    
                    // Update statistics
                    document.getElementById('secureBannedEmails').textContent = emailBans.length;
                    document.getElementById('secureBannedIPs').textContent = ipBans.length;
                    
                } catch (error) {
                    console.error('Error refreshing secure ban data:', error);
                    showToast('Error refreshing ban data', 'error');
                }
            }
        }
        
        // Remove secure email ban
        function removeSecureEmailBan(email) {
            if (confirm(`Remove ban for email: ${email}?`)) {
                if (window.SecureBanSystem) {
                    try {
                        const result = window.SecureBanSystem.removeEmailBan(email);
                        if (result.success) {
                            showToast(`Email ban removed: ${email}`, 'success');
                            refreshSecureBanData();
                            
                            // Log removal
                            if (window.SecureLogger) {
                                window.SecureLogger.logSecure('admin_email_unban', {
                                    email: email,
                                    timestamp: new Date().toISOString(),
                                    admin: 'dashboard_user'
                                });
                            }
                        } else {
                            showToast(result.message || 'Failed to remove email ban', 'error');
                        }
                    } catch (error) {
                        console.error('Error removing email ban:', error);
                        showToast('Error removing email ban', 'error');
                    }
                }
            }
        }
        
        // Remove secure IP ban
        function removeSecureIPBan(ip) {
            if (confirm(`Remove ban for IP: ${ip}?`)) {
                if (window.SecureBanSystem) {
                    try {
                        const result = window.SecureBanSystem.removeIPBan(ip);
                        if (result.success) {
                            showToast(`IP ban removed: ${ip}`, 'success');
                            refreshSecureBanData();
                            
                            // Log removal
                            if (window.SecureLogger) {
                                window.SecureLogger.logSecure('admin_ip_unban', {
                                    ip: ip,
                                    timestamp: new Date().toISOString(),
                                    admin: 'dashboard_user'
                                });
                            }
                        } else {
                            showToast(result.message || 'Failed to remove IP ban', 'error');
                        }
                    } catch (error) {
                        console.error('Error removing IP ban:', error);
                        showToast('Error removing IP ban', 'error');
                    }
                }
            }
        }
        
        // Export secure ban list
        function exportSecureBanList() {
            try {
                if (window.SecureBanSystem) {
                    const emailBans = window.SecureBanSystem.getEmailBans();
                    const ipBans = window.SecureBanSystem.getIPBans();
                    
                    const exportData = {
                        exportedAt: new Date().toISOString(),
                        emailBans: emailBans,
                        ipBans: ipBans,
                        totalBans: emailBans.length + ipBans.length,
                        securityLevel: '99% Protection'
                    };
                    
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `secure_ban_list_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showToast('Secure ban list exported successfully!', 'success');
                } else {
                    showToast('Secure ban system not available', 'error');
                }
            } catch (error) {
                console.error('Error exporting ban list:', error);
                showToast('Error exporting ban list', 'error');
            }
        }
        
        // Advanced security functions
        function performAdvancedCleanup() {
            if (confirm('Perform advanced security cleanup? This will optimize the ban system.')) {
                if (window.SecureBanSystem) {
                    try {
                        window.SecureBanSystem.performCleanup();
                        showToast('Advanced security cleanup completed', 'success');
                        refreshSecureBanData();
                    } catch (error) {
                        console.error('Error during cleanup:', error);
                        showToast('Error during security cleanup', 'error');
                    }
                } else {
                    showToast('Secure ban system not available', 'error');
                }
            }
        }
        
        function generateSecurityInsights() {
            if (window.SecureBanSystem) {
                try {
                    const insights = window.SecureBanSystem.generateInsights();
                    alert(`üîí Security Insights:\n\n${JSON.stringify(insights, null, 2)}`);
                } catch (error) {
                    console.error('Error generating insights:', error);
                    showToast('Error generating security insights', 'error');
                }
            } else {
                showToast('Secure ban system not available', 'error');
            }
        }
        
        function openSecureLogViewer() {
            if (window.SecureLogger) {
                try {
                    const logs = window.SecureLogger.getSecureLogs();
                    const logText = logs.slice(0, 50).map(log => 
                        `[${new Date(log.timestamp).toLocaleString()}] ${log.type}: ${JSON.stringify(log.data)}`
                    ).join('\n');
                    alert(`üîí Secure Logs (Last 50 entries):\n\n${logText}`);
                } catch (error) {
                    console.error('Error opening log viewer:', error);
                    showToast('Error opening secure log viewer', 'error');
                }
            } else {
                showToast('Secure logger not available', 'error');
            }
        }
        
        function clearAllSecureBans() {
            if (confirm('‚ö†Ô∏è Clear ALL secure bans? This action cannot be undone and will remove all security protections!')) {
                if (window.SecureBanSystem) {
                    try {
                        window.SecureBanSystem.clearAllBans();
                        showToast('All secure bans cleared', 'warning');
                        refreshSecureBanData();
                        
                        // Log this critical action
                        if (window.SecureLogger) {
                            window.SecureLogger.logSecure('admin_clear_all_bans', {
                                timestamp: new Date().toISOString(),
                                admin: 'dashboard_user',
                                severity: 'critical'
                            });
                        }
                    } catch (error) {
                        console.error('Error clearing bans:', error);
                        showToast('Error clearing all bans', 'error');
                    }
                } else {
                    showToast('Secure ban system not available', 'error');
                }
            }
        }
        
        function exportSecurityLogs() {
            try {
                if (window.SecureLogger) {
                    const logs = window.SecureLogger.getSecureLogs();
                    const exportData = {
                        exportedAt: new Date().toISOString(),
                        totalLogs: logs.length,
                        logs: logs
                    };
                    
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `security_logs_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    showToast('Security logs exported successfully!', 'success');
                } else {
                    showToast('Secure logger not available', 'error');
                }
            } catch (error) {
                console.error('Error exporting security logs:', error);
                showToast('Error exporting security logs', 'error');
            }
        }
        
        function runSecurityScan() {
            if (window.SecureBanSystem) {
                try {
                    showToast('Running security scan...', 'info');
                    const scanResult = window.SecureBanSystem.runSecurityScan();
                    showToast(`Security scan completed: ${scanResult.message}`, 'success');
                } catch (error) {
                    console.error('Error running security scan:', error);
                    showToast('Error running security scan', 'error');
                }
            } else {
                showToast('Secure ban system not available', 'error');
            }
        }
        
        function optimizeSecuritySettings() {
            if (window.SecureBanSystem) {
                try {
                    window.SecureBanSystem.optimizeSettings();
                    showToast('Security settings optimized', 'success');
                } catch (error) {
                    console.error('Error optimizing security settings:', error);
                    showToast('Error optimizing security settings', 'error');
                }
            } else {
                showToast('Secure ban system not available', 'error');
            }
        }
        
        function analyzeIPThreats() {
            if (window.SecureBanSystem) {
                try {
                    const analysis = window.SecureBanSystem.analyzeIPThreats();
                    alert(`üîç IP Threat Analysis:\n\n${JSON.stringify(analysis, null, 2)}`);
                } catch (error) {
                    console.error('Error analyzing IP threats:', error);
                    showToast('Error analyzing IP threats', 'error');
                }
            } else {
                showToast('Secure ban system not available', 'error');
            }
        }
        
        // Initialize secure ban system when dashboard loads
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for secure ban system to load
            setTimeout(() => {
                refreshSecureBanData();
                
                // Update real-time security monitor
                if (window.SecureBanSystem) {
                    setInterval(() => {
                        try {
                            const stats = window.SecureBanSystem.getRealTimeStats();
                            document.getElementById('activeConnections').textContent = stats.activeConnections || 0;
                            document.getElementById('behaviorScore').textContent = stats.behaviorScore || 0;
                            document.getElementById('threatLevel').textContent = stats.threatLevel || 'LOW';
                        } catch (error) {
                            // Silently handle errors
                        }
                    }, 5000); // Update every 5 seconds
                }
            }, 1000);
        });
        
        // ===== END SECURE BAN SYSTEM FUNCTIONS =====

        // System Check Tab Functions
        function loadSystemCheckTab() {
            console.log('Loading System Check tab...');
            runFullSystemCheck();
        }

        // System check variables
        const systemServices = [
            { name: 'IP Detection Services', endpoint: 'https://api.ipify.org?format=json', description: 'External IP detection' },
            { name: 'Google Authentication', endpoint: 'https://accounts.google.com', description: 'User authentication service' },
            { name: 'EmailJS Service', endpoint: 'https://api.emailjs.com', description: 'Email delivery service' },
            { name: 'Ban System', endpoint: '/api/bans', description: 'Internal ban management system' },
            { name: 'Product Database', endpoint: '/api/products', description: 'Product catalog service' }
        ];

        const systemFunctions = [
            { name: 'Local Storage', description: 'Browser data persistence' },
            { name: 'Session Management', description: 'User session handling' },
            { name: 'Security Logger', description: 'Security event logging' },
            { name: 'Ban Detection', description: 'Real-time ban verification' },
            { name: 'Analytics Tracking', description: 'User behavior analytics' }
        ];

        async function runFullSystemCheck() {
            console.log('üîç Running full system check...');
            updateSystemStatus('running', 'Running comprehensive system check...');
            
            // Check all services
            await checkAllServices();
            
            // Test all functions  
            await runAllFunctionTests();
            
            // Update overall status
            updateOverallSystemHealth();
            
            // Update last check time
            document.getElementById('last-check-time').textContent = new Date().toLocaleTimeString();
            
            console.log('‚úÖ System check completed');
        }

        async function checkAllServices() {
            const tableBody = document.getElementById('systemServicesTable');
            tableBody.innerHTML = '';
            
            let onlineCount = 0;
            
            for (const service of systemServices) {
                const row = await checkService(service);
                tableBody.appendChild(row);
                
                if (row.querySelector('.status-indicator').textContent.includes('üü¢')) {
                    onlineCount++;
                }
            }
            
            document.getElementById('services-online-count').textContent = `${onlineCount}/${systemServices.length}`;
        }

        async function checkService(service) {
            const row = document.createElement('tr');
            const startTime = performance.now();
            
            try {
                const response = await fetch(service.endpoint, { 
                    method: 'HEAD',
                    mode: 'no-cors',
                    signal: AbortSignal.timeout(5000)
                });
                
                const responseTime = Math.round(performance.now() - startTime);
                const status = response.status >= 200 && response.status < 300 ? 'online' : 'warning';
                
                row.innerHTML = `
                    <td>${service.name}</td>
                    <td><span class="status-indicator">${status === 'online' ? 'üü¢ Online' : 'üü° Warning'}</span></td>
                    <td>${responseTime}ms</td>
                    <td>${new Date().toLocaleTimeString()}</td>
                    <td>${service.description}</td>
                    <td><button class="action-button secondary" onclick="checkSingleService('${service.name}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Test</button></td>
                `;
            } catch (error) {
                const responseTime = Math.round(performance.now() - startTime);
                row.innerHTML = `
                    <td>${service.name}</td>
                    <td><span class="status-indicator">üî¥ Offline</span></td>
                    <td>${responseTime}ms</td>
                    <td>${new Date().toLocaleTimeString()}</td>
                    <td>${service.description}</td>
                    <td><button class="action-button secondary" onclick="checkSingleService('${service.name}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Retry</button></td>
                `;
            }
            
            return row;
        }

        async function runAllFunctionTests() {
            const tableBody = document.getElementById('functionTestsTable');
            tableBody.innerHTML = '';
            
            for (const func of systemFunctions) {
                const row = await testFunction(func);
                tableBody.appendChild(row);
            }
        }

        async function testFunction(func) {
            const row = document.createElement('tr');
            const startTime = performance.now();
            
            try {
                let result = 'Pass';
                let status = 'üü¢ Pass';
                
                switch (func.name) {
                    case 'Local Storage':
                        localStorage.setItem('_test', 'test');
                        localStorage.removeItem('_test');
                        break;
                    case 'Session Management':
                        const user = JSON.parse(localStorage.getItem('user') || '{}');
                        if (Object.keys(user).length === 0) {
                            result = 'No active session';
                            status = 'üü° Warning';
                        }
                        break;
                    case 'Security Logger':
                        if (typeof window.secureLogger === 'undefined') {
                            result = 'Logger not initialized';
                            status = 'üî¥ Fail';
                        }
                        break;
                    case 'Ban Detection':
                        if (typeof window.banSystem === 'undefined') {
                            result = 'Ban system not loaded';
                            status = 'üî¥ Fail';
                        }
                        break;
                    case 'Analytics Tracking':
                        if (typeof gtag === 'undefined' && typeof plausible === 'undefined') {
                            result = 'No analytics detected';
                            status = 'üü° Warning';
                        }
                        break;
                }
                
                const executionTime = Math.round(performance.now() - startTime);
                
                row.innerHTML = `
                    <td>${func.name}</td>
                    <td><span class="status-indicator">${status}</span></td>
                    <td>${result}</td>
                    <td>${executionTime}ms</td>
                    <td>${new Date().toLocaleTimeString()}</td>
                    <td><button class="action-button secondary" onclick="testSingleFunction('${func.name}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Test</button></td>
                `;
                
            } catch (error) {
                const executionTime = Math.round(performance.now() - startTime);
                row.innerHTML = `
                    <td>${func.name}</td>
                    <td><span class="status-indicator">üî¥ Error</span></td>
                    <td>${error.message}</td>
                    <td>${executionTime}ms</td>
                    <td>${new Date().toLocaleTimeString()}</td>
                    <td><button class="action-button secondary" onclick="testSingleFunction('${func.name}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Retry</button></td>
                `;
            }
            
            return row;
        }

        function updateOverallSystemHealth() {
            const services = document.querySelectorAll('#systemServicesTable .status-indicator');
            const functions = document.querySelectorAll('#functionTestsTable .status-indicator');
            
            let totalChecks = services.length + functions.length;
            let passCount = 0;
            let warningCount = 0;
            let failCount = 0;
            
            [...services, ...functions].forEach(indicator => {
                if (indicator.textContent.includes('üü¢')) passCount++;
                else if (indicator.textContent.includes('üü°')) warningCount++;
                else if (indicator.textContent.includes('üî¥')) failCount++;
            });
            
            let overallStatus = 'üü¢ Healthy';
            let statusText = 'All systems operational';
            let navBadge = 'üü¢';
            
            if (failCount > 0) {
                overallStatus = 'üî¥ Critical';
                statusText = `${failCount} critical issues detected`;
                navBadge = 'üî¥';
            } else if (warningCount > 0) {
                overallStatus = 'üü° Warning';
                statusText = `${warningCount} warnings detected`;
                navBadge = 'üü°';
            }
            
            document.getElementById('overall-health-status').textContent = overallStatus;
            document.getElementById('overall-health-description').textContent = statusText;
            document.getElementById('overall-health-icon').textContent = navBadge;
            document.getElementById('system-status').textContent = navBadge;
            document.getElementById('issues-count').textContent = failCount + warningCount;
        }

        function updateSystemStatus(status, message) {
            const statusElement = document.getElementById('overall-health-status');
            const descElement = document.getElementById('overall-health-description');
            
            if (status === 'running') {
                statusElement.textContent = 'üîÑ Checking...';
                descElement.textContent = message;
            }
        }

        function refreshSystemStatus() {
            runFullSystemCheck();
        }

        function exportSystemReport() {
            const report = {
                timestamp: new Date().toISOString(),
                services: Array.from(document.querySelectorAll('#systemServicesTable tr')).slice(1).map(row => ({
                    name: row.cells[0].textContent,
                    status: row.cells[1].textContent,
                    responseTime: row.cells[2].textContent,
                    lastCheck: row.cells[3].textContent,
                    description: row.cells[4].textContent
                })),
                functions: Array.from(document.querySelectorAll('#functionTestsTable tr')).slice(1).map(row => ({
                    name: row.cells[0].textContent,
                    status: row.cells[1].textContent,
                    result: row.cells[2].textContent,
                    executionTime: row.cells[3].textContent,
                    lastTest: row.cells[4].textContent
                })),
                overallHealth: document.getElementById('overall-health-status').textContent
            };
            
            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `system-report-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        async function checkSingleService(serviceName) {
            console.log(`Testing single service: ${serviceName}`);
            const service = systemServices.find(s => s.name === serviceName);
            if (service) {
                await checkService(service);
                updateOverallSystemHealth();
            }
        }

        async function testSingleFunction(functionName) {
            console.log(`Testing single function: ${functionName}`);
            const func = systemFunctions.find(f => f.name === functionName);
            if (func) {
                await testFunction(func);
                updateOverallSystemHealth();
            }
        }

        // Initialize system check if on system-check tab
        if (window.location.hash === '#system-check') {
            setTimeout(loadSystemCheckTab, 1000);
        }

        // Placeholder for script.js if it was intended to be separate
        function closeUserDetailModal() { alert('Close User Detail Modal called'); }
        function exportSystemLogs() { console.log('exportSystemLogs called'); }
        function clearSystemLogs() { console.log('clearSystemLogs called'); }

    </script>

    <!-- External Scripts -->
    <!-- Secure Ban System Scripts -->
    <script src="secure-logger.js"></script>
    <script src="secure-ban-system.js"></script>
    <script src="script.js"></script>
</body>
</html>