class SecureLogger{constructor(){this.encryptionKey=null;this.logQueue=[];this.maxLogs=5000;this.initialized=false;this.logLevels={debug: 0,info: 1,warning: 2,error: 3,security: 4,critical: 5};this.consoleLogLevel=2;}init(){try{this.encryptionKey=this.generateEncryptionKey();this.initialized=true;if(this.isDevelopmentMode()){console.log('ðŸ” Secure Logger initialized');}this.logSecure('Secure logger initialized',{timestamp: Date.now(),level: 'info'});setInterval(()=> this.cleanupLogs(),300000);}catch(error){if(this.isDevelopmentMode()){console.error('Secure Logger initialization failed:',error);}}}generateEncryptionKey(){const array=new Uint8Array(32);if(window.crypto && window.crypto.getRandomValues){window.crypto.getRandomValues(array);}else{for(let i=0;i < array.length;i++){array[i]=Math.floor(Math.random()*256)^ Math.floor(performance.now()*1000)& 0xFF;}}return Array.from(array).map(b=> b.toString(16).padStart(2,'0')).join('');}isDevelopmentMode(){return location.hostname==='localhost' || location.hostname==='127.0.0.1' || location.hostname.includes('replit.dev')|| location.hostname.includes('repl.co');}logSecure(message,data={}){if(!this.initialized){this.queueLog(message,data);return;}try{const logEntry={id: this.generateLogId(),timestamp: Date.now(),message: message,data: data,level: data.level || 'info',hash: this.generateLogHash(message,data),encrypted: this.encryptData(data)};this.storeLog(logEntry);if(this.shouldShowInConsole(logEntry.level)){this.displayInConsole(logEntry);}}catch(error){if(this.isDevelopmentMode()){console.error('Secure logging failed:',error);}}}queueLog(message,data){this.logQueue.push({message,data,timestamp: Date.now()});if(this.initialized && this.logQueue.length > 0){this.logQueue.forEach(queued=>{this.logSecure(queued.message,{...queued.data,timestamp: queued.timestamp});});this.logQueue=[];}}generateLogId(){const timestamp=Date.now().toString(36);const random=Math.random().toString(36).substr(2,9);return `SL_${timestamp}_${random}`;}generateLogHash(message,data){const content=message+JSON.stringify(data)+this.encryptionKey;let hash=0;for(let i=0;i < content.length;i++){const char=content.charCodeAt(i);hash=((hash << 5)-hash)+char;hash=hash & hash;}return Math.abs(hash).toString(36);}encryptData(data){try{const sensitiveFields=['email','ip','fingerprint','userAgent','error'];const encrypted={};for(const field of sensitiveFields){if(data[field]){encrypted[field]=this.simpleEncrypt(String(data[field]));}}return encrypted;}catch(error){return{};}}simpleEncrypt(text){try{let result='';const key=this.encryptionKey;for(let i=0;i < text.length;i++){const charCode=text.charCodeAt(i);const keyCode=key.charCodeAt(i % key.length);const encrypted=(charCode ^ keyCode)+128;result+=String.fromCharCode(encrypted % 256);}return btoa(result);}catch(error){return text;}}simpleDecrypt(encryptedText){try{const decoded=atob(encryptedText);let result='';const key=this.encryptionKey;for(let i=0;i < decoded.length;i++){const charCode=decoded.charCodeAt(i);const keyCode=key.charCodeAt(i % key.length);const decrypted=(charCode-128)^ keyCode;result+=String.fromCharCode(decrypted);}return result;}catch(error){return encryptedText;}}storeLog(logEntry){try{const logs=this.getStoredLogs();logs.push(logEntry);if(logs.length > this.maxLogs){logs.splice(0,logs.length-this.maxLogs);}const logData={version: '1.0',lastUpdate: Date.now(),logCount: logs.length,checksum: this.generateChecksum(logs),logs: logs};localStorage.setItem('secure_system_logs',JSON.stringify(logData));}catch(error){if(!this.memoryLogs)this.memoryLogs=[];this.memoryLogs.push(logEntry);if(this.memoryLogs.length > 100){this.memoryLogs.shift();}}}getStoredLogs(){try{const stored=localStorage.getItem('secure_system_logs');if(!stored)return [];const logData=JSON.parse(stored);if(!logData.logs || !Array.isArray(logData.logs))return [];const currentChecksum=this.generateChecksum(logData.logs);if(currentChecksum !==logData.checksum){if(this.isDevelopmentMode()){console.warn('Log integrity violation detected');}return [];}return logData.logs;}catch(error){return this.memoryLogs || [];}}generateChecksum(logs){try{const content=logs.map(log=> log.id+log.hash).join('');let checksum=0;for(let i=0;i < content.length;i++){checksum=((checksum << 5)-checksum)+content.charCodeAt(i);checksum=checksum & checksum;}return Math.abs(checksum).toString(36);}catch(error){return '0';}}shouldShowInConsole(level){if(!this.isDevelopmentMode())return false;const levelNum=this.logLevels[level] || 0;return levelNum >=this.consoleLogLevel;}displayInConsole(logEntry){if(!this.isDevelopmentMode())return;const level=logEntry.level;const message=logEntry.message;const time=new Date(logEntry.timestamp).toLocaleTimeString();switch(level){case 'debug': console.debug(`ðŸ” [${time}] ${message}`);break;case 'info': console.info(`â„¹ï¸ [${time}] ${message}`);break;case 'warning': console.warn(`âš ï¸ [${time}] ${message}`);break;case 'error': console.error(`âŒ [${time}] ${message}`);break;case 'security': console.error(`ðŸ”’ [${time}] SECURITY: ${message}`);break;case 'critical': console.error(`ðŸš¨ [${time}] CRITICAL: ${message}`);break;default: console.log(`ðŸ“ [${time}] ${message}`);}}cleanupLogs(){try{const logs=this.getStoredLogs();const cutoffTime=Date.now()-(24*60*60*1000*7);const filteredLogs=logs.filter(log=> log.timestamp > cutoffTime);if(filteredLogs.length !==logs.length){const logData={version: '1.0',lastUpdate: Date.now(),logCount: filteredLogs.length,checksum: this.generateChecksum(filteredLogs),logs: filteredLogs};localStorage.setItem('secure_system_logs',JSON.stringify(logData));this.logSecure('Log cleanup completed',{removedCount: logs.length-filteredLogs.length,timestamp: Date.now(),level: 'info'});}}catch(error){if(this.isDevelopmentMode()){console.error('Log cleanup failed:',error);}}}getLogsForDashboard(options={}){try{const logs=this.getStoredLogs();const{level=null,limit=100,startTime=null,endTime=null,includeSensitive=false}=options;let filteredLogs=logs;if(level){filteredLogs=filteredLogs.filter(log=> log.level===level);}if(startTime){filteredLogs=filteredLogs.filter(log=> log.timestamp >=startTime);}if(endTime){filteredLogs=filteredLogs.filter(log=> log.timestamp <=endTime);}filteredLogs.sort((a,b)=> b.timestamp-a.timestamp);filteredLogs=filteredLogs.slice(0,limit);if(!includeSensitive){filteredLogs=filteredLogs.map(log=>({...log,data: this.sanitizeDataForDashboard(log.data),encrypted: undefined}));}else{filteredLogs=filteredLogs.map(log=>({...log,data:{...log.data,...this.decryptLogData(log.encrypted)}}));}return filteredLogs;}catch(error){this.logSecure('Error retrieving dashboard logs',{error: error.message,timestamp: Date.now(),level: 'error'});return [];}}sanitizeDataForDashboard(data){const sanitized={...data};if(sanitized.email){sanitized.email=this.maskEmail(sanitized.email);}if(sanitized.ip){sanitized.ip=this.maskIP(sanitized.ip);}if(sanitized.fingerprint){sanitized.fingerprint=sanitized.fingerprint.substring(0,8)+'...';}if(sanitized.userAgent){sanitized.userAgent=this.maskUserAgent(sanitized.userAgent);}return sanitized;}decryptLogData(encryptedData){if(!encryptedData)return{};const decrypted={};for(const [field,value] of Object.entries(encryptedData)){try{decrypted[field]=this.simpleDecrypt(value);}catch(error){decrypted[field]='[Decryption Failed]';}}return decrypted;}maskEmail(email){if(!email || typeof email !=='string')return '[Invalid Email]';const parts=email.split('@');if(parts.length !==2)return '[Invalid Email]';const username=parts[0];const domain=parts[1];if(username.length <=2){return `${username[0]}*@${domain}`;}else{return `${username[0]}${'*'.repeat(username.length-2)}${username[username.length-1]}@${domain}`;}}maskIP(ip){if(!ip || typeof ip !=='string')return '[Invalid IP]';const parts=ip.split('.');if(parts.length !==4)return '[Invalid IP]';return `${parts[0]}.${parts[1]}.*.***`;}maskUserAgent(userAgent){if(!userAgent || typeof userAgent !=='string')return '[Invalid UA]';const simplified=userAgent .replace(/\d+\.\d+\.\d+\.\d+/g,'X.X.X.X').replace(/Chrome\/[\d.]+/g,'Chrome/X.X').replace(/Firefox\/[\d.]+/g,'Firefox/X.X').replace(/Safari\/[\d.]+/g,'Safari/X.X');return simplified.length > 100 ? simplified.substring(0,100)+'...' : simplified;}getSecurityLogs(limit=50){return this.getLogsForDashboard({level: 'security',limit: limit,includeSensitive: false});}getErrorLogs(limit=50){const errors=this.getLogsForDashboard({level: 'error',limit: limit,includeSensitive: false});const critical=this.getLogsForDashboard({level: 'critical',limit: limit,includeSensitive: false});return [...critical,...errors] .sort((a,b)=> b.timestamp-a.timestamp).slice(0,limit);}getLogStatistics(){try{const logs=this.getStoredLogs();const now=Date.now();const oneHour=60*60*1000;const oneDay=24*oneHour;const oneWeek=7*oneDay;const stats={total: logs.length,lastHour: logs.filter(log=> now-log.timestamp < oneHour).length,lastDay: logs.filter(log=> now-log.timestamp < oneDay).length,lastWeek: logs.filter(log=> now-log.timestamp < oneWeek).length,byLevel:{}};for(const level of Object.keys(this.logLevels)){stats.byLevel[level]=logs.filter(log=> log.level===level).length;}return stats;}catch(error){return{total: 0,lastHour: 0,lastDay: 0,lastWeek: 0,byLevel:{}};}}exportLogs(password=null){try{if(!password){throw new Error('Password required for log export');}const expectedHash=this.hashString(password+this.encryptionKey);const adminHash=this.hashString('admin123'+this.encryptionKey);if(expectedHash !==adminHash){this.logSecure('Unauthorized log export attempt',{timestamp: Date.now(),level: 'security'});throw new Error('Invalid password');}const logs=this.getLogsForDashboard({limit: 10000,includeSensitive: true});const exportData={exportTime: Date.now(),totalLogs: logs.length,logs: logs};this.logSecure('Logs exported',{exportedCount: logs.length,timestamp: Date.now(),level: 'security'});return exportData;}catch(error){this.logSecure('Log export failed',{error: error.message,timestamp: Date.now(),level: 'error'});throw error;}}clearAllLogs(password=null){try{if(!password){throw new Error('Password required for log clearing');}const expectedHash=this.hashString(password+this.encryptionKey);const adminHash=this.hashString('admin123'+this.encryptionKey);if(expectedHash !==adminHash){this.logSecure('Unauthorized log clear attempt',{timestamp: Date.now(),level: 'security'});throw new Error('Invalid password');}const logCount=this.getStoredLogs().length;localStorage.removeItem('secure_system_logs');this.memoryLogs=[];this.logSecure('All logs cleared',{clearedCount: logCount,timestamp: Date.now(),level: 'security'});return true;}catch(error){this.logSecure('Log clear failed',{error: error.message,timestamp: Date.now(),level: 'error'});throw error;}}hashString(str){let hash=0;if(str.length===0)return hash.toString(36);for(let i=0;i < str.length;i++){const char=str.charCodeAt(i);hash=((hash << 5)-hash)+char;hash=hash & hash;}return Math.abs(hash).toString(36);}}window.SecureLogger=SecureLogger;